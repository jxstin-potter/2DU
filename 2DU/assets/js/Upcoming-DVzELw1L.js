var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var Y=(t,e,o)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,R=(t,e)=>{for(var o in e||(e={}))se.call(e,o)&&Y(t,o,e[o]);if(W)for(var o of W(e))oe.call(e,o)&&Y(t,o,e[o]);return t},L=(t,e)=>te(t,ae(e));var S=(t,e,o)=>new Promise((g,h)=>{var p=m=>{try{i(o.next(m))}catch(r){h(r)}},u=m=>{try{i(o.throw(m))}catch(r){h(r)}},i=m=>m.done?g(m.value):Promise.resolve(m.value).then(p,u);i((o=o.apply(t,e)).next())});import{j as s,r as l}from"./vendor-BwNiVhmj.js";import{u as G,B as I,T as D,d as H,aA as ne,aB as K,aC as re,aD as ce,aE as ie,aF as le,ar as de,q as ue,S as me,p as pe,az as he}from"./mui-z4ihkPrE.js";import{u as fe,d as ge,l as xe}from"./index-ChBqKc9D.js";import{T as ke,a as ye,b as Te}from"./TaskDetailModal-CKBa4nUZ.js";import{B as z,F as _e,z as Ce,a as be,d as N,u as je}from"./utils-DwmbZkdi.js";import{s as De,t as F,u as V,d as we,c as Se,a as Ie}from"./tasksService-DHXsAsTk.js";const ve="_container_148xm_1",Ee="_iconToday_148xm_57 _iconContainer_148xm_27",Me="_iconUpcoming_148xm_67 _iconContainer_148xm_27",Ne="_iconCompleted_148xm_77 _iconContainer_148xm_27",Ae="_iconTags_148xm_87 _iconContainer_148xm_27",Ue="_iconCalendar_148xm_97 _iconContainer_148xm_27",Fe="_title_148xm_107",ze="_description_148xm_121",k={container:ve,iconToday:Ee,iconUpcoming:Me,iconCompleted:Ne,iconTags:Ae,iconCalendar:Ue,title:Fe,description:ze},Be=({type:t,onCreateTask:e})=>{const o=G(),g=()=>{switch(t){case"today":return k.iconToday;case"upcoming":return k.iconUpcoming;case"completed":return k.iconCompleted;case"tags":return k.iconTags;case"calendar":return k.iconCalendar;default:return k.iconToday}},h=()=>{const i={fontSize:60,color:t==="completed"?o.palette.success.main:o.palette.primary.main};switch(t){case"today":return s.jsx(K,{sx:i});case"upcoming":return s.jsx(le,{sx:i});case"completed":return s.jsx(ie,{sx:i});case"tags":return s.jsx(ce,{sx:i});case"calendar":return s.jsx(re,{sx:i});default:return s.jsx(K,{sx:i})}},p=()=>{switch(t){case"today":return"No tasks for today";case"upcoming":return"No upcoming tasks";case"completed":return"No completed tasks";case"tags":return"No tagged tasks";case"calendar":return"No tasks scheduled";default:return"No tasks"}},u=()=>{switch(t){case"today":return"You have no tasks scheduled for today. Add a new task to get started.";case"upcoming":return"You have no upcoming tasks. Plan ahead by adding tasks with future due dates.";case"completed":return"You haven't completed any tasks yet. Complete tasks to see them here.";case"tags":return"You haven't tagged any tasks yet. Add tags to your tasks to organize them.";case"calendar":return"You have no tasks scheduled. Add tasks with due dates to see them in your calendar.";default:return"You have no tasks. Add a new task to get started."}};return s.jsxs(I,{className:k.container,sx:{borderColor:o.palette.divider,backgroundColor:o.palette.mode==="dark"?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)"},children:[s.jsx("div",{className:g(),children:h()}),s.jsx(D,{variant:"h5",className:k.title,sx:{color:o.palette.text.primary,mb:.5},children:p()}),s.jsx(D,{variant:"body2",className:k.description,sx:{color:o.palette.text.secondary,mb:3,maxWidth:"400px"},children:u()}),e&&s.jsx(H,{variant:"contained",color:"primary",startIcon:s.jsx(ne,{}),onClick:e,sx:{borderRadius:"6px","&:hover":{transform:"translateY(-2px)",boxShadow:o.shadows[4]}},children:"Add New Task"})]})};function q(t){return N(t,"yyyy-MM-dd")}function $e(t,e){const o=N(t,"MMM d");return je(t,e)?`${o} ‧ Today ‧ ${N(t,"EEEE")}`:`${o} ‧ ${N(t,"EEEE")}`}function j(t){return z(new Date(t))}function Oe(t){return t.completed!==!0&&t.dueDate!=null}function Pe(t,e){var m;const o=z(new Date),g=j(e.startDate),h=t.filter(Oe);let p=j(_e(e.focusedMonth));for(const r of h){const f=j(r.dueDate);f.getTime()>p.getTime()&&(p=f)}const u=new Map;for(const r of h){const f=j(r.dueDate);if(Ce(f,g))continue;const c=q(f),x=u.get(c);x?x.push(r):u.set(c,[r])}const i=[];for(let r=g;r.getTime()<=p.getTime();r=be(r,1)){const f=q(r),c=(m=u.get(f))!=null?m:[];c.length!==0&&(c.sort((x,y)=>{var C,b;const A=j(x.dueDate).getTime(),w=j(y.dueDate).getTime();if(A!==w)return A-w;const v=(C=x.order)!=null?C:Number.POSITIVE_INFINITY,_=(b=y.order)!=null?b:Number.POSITIVE_INFINITY;return v!==_?v-_:x.title.localeCompare(y.title)}),i.push({key:f,kind:"day",title:$e(r,o),date:r,anchorId:`selection-${f}`,tasks:c}))}return i}const He=()=>{const t=G(),{user:e,loading:o}=fe(),{isOpen:g,openModal:h,closeModal:p}=ge(),[u,i]=l.useState([]),[m,r]=l.useState(!0),[f,c]=l.useState(null),[x,y]=l.useState(null),[A,w]=l.useState(null),[v,_]=l.useState(!1),[C,b]=l.useState(null),E=l.useRef(0);l.useEffect(()=>{if(!(e!=null&&e.id)){i([]),r(!1),E.current=0;return}r(!0),c(null),E.current=0;const n=De(e.id,{completionStatus:"all",sortBy:"creationDate",sortOrder:"desc"},a=>{try{const d=a.tasks.length;if(d===0&&E.current>0)return;E.current=d;const U=a.tasks.map(T=>{var P;try{return Ie(T)}catch(We){return{id:T.id||"",title:T.title||"Untitled Task",completed:(P=T.completed)!=null?P:!1,userId:T.userId||"",createdAt:new Date,updatedAt:new Date}}});i(U),a.fromServer!==!1&&r(!1),c(null)}catch(d){c("Failed to process tasks"),r(!1)}});return()=>n()},[e==null?void 0:e.id]);const M=l.useCallback(n=>S(void 0,null,function*(){if(!(e!=null&&e.id)){c("Please log in to toggle tasks");return}try{const a=u.find(T=>T.id===n);if(!a)return;const d=!a.completed,U=F({completed:d});yield V(n,U,e.id),d&&(b(n),_(!0))}catch(a){c(a instanceof Error?a.message:"Failed to toggle task status")}}),[u,e==null?void 0:e.id]),J=l.useCallback(()=>{C&&(M(C),_(!1),b(null))},[C,M]),B=l.useCallback((n,a)=>{a!=="clickaway"&&(_(!1),b(null))},[]),Q=l.useCallback(n=>S(void 0,null,function*(){if(!(e!=null&&e.id)){c("Please log in to delete tasks");return}try{yield we(n,e.id)}catch(a){c(a instanceof Error?a.message:"Failed to delete task")}}),[e==null?void 0:e.id]),$=l.useCallback((n,a)=>S(void 0,null,function*(){if(!(e!=null&&e.id)){c("Please log in to update tasks");return}try{const d=F(a);yield V(n,d,e.id)}catch(d){c(d instanceof Error?d.message:"Failed to update task")}}),[e==null?void 0:e.id]),X=l.useCallback(n=>S(void 0,null,function*(){try{if(o)throw new Error("Please wait for authentication to complete");if(!(e!=null&&e.id))throw new Error("Please log in to create tasks");const a=F(L(R({},n),{userId:e.id,completed:!1,order:u.length})),d=yield Se(e.id,a);w(d),setTimeout(()=>w(null),600),y(null),p()}catch(a){const d=a instanceof Error?a.message:"Failed to create task";throw c(d),xe.error("Failed to create task",{action:"createTask"},a),a}}),[o,p,u.length,e==null?void 0:e.id]),O=l.useMemo(()=>{const n=u.filter(a=>!a.completed&&a.dueDate!=null);return Pe(n,{focusedMonth:new Date,startDate:z(new Date)})},[u]),Z=O.some(n=>n.tasks.length>0);return s.jsx(I,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"flex-start",width:"100%",pl:0,ml:-1,mt:-.5},children:s.jsxs(de,{maxWidth:"md",disableGutters:!0,sx:{width:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[s.jsxs(I,{sx:{width:"100%",maxWidth:t.breakpoints.values.sm},children:[s.jsxs(I,{sx:{mb:2},children:[s.jsx(D,{variant:"h5",component:"h1",sx:{fontWeight:t.typography.fontWeightBold,mb:.5},children:"Upcoming"}),s.jsx(D,{variant:"body2",color:"text.secondary",children:"Tasks with due dates, grouped by day."})]}),!m&&!Z?s.jsx(Be,{type:"upcoming",onCreateTask:()=>h()}):O.map(n=>s.jsxs(I,{id:n.anchorId,sx:{mb:3},children:[s.jsx(D,{variant:"h6",sx:{fontWeight:t.typography.fontWeightBold,fontSize:t.typography.body1.fontSize,mb:1.5,color:"text.secondary"},children:n.title}),n.tasks.length===0?s.jsx(D,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"No tasks"}):s.jsx(ue,{sx:{py:0},children:n.tasks.map(a=>s.jsx(ke,{task:a,onToggleComplete:()=>M(a.id),onDelete:()=>Q(a.id),onEdit:()=>{y(a),h()},onUpdate:$,isActionInProgress:!1},a.id))})]},n.key))]}),x?s.jsx(ye,{open:g,onClose:()=>{p(),y(null)},task:x,onUpdate:$,onToggleComplete:M}):s.jsx(Te,{open:g,onClose:()=>{p(),y(null)},onSubmit:X,initialTask:null,loading:m}),s.jsx(me,{open:v,anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:15e3,onClose:B,message:"1 task completed",action:s.jsxs(s.Fragment,{children:[s.jsx(H,{color:"inherit",size:"small",onClick:J,children:"Undo"}),s.jsx(pe,{size:"small","aria-label":"Close",color:"inherit",onClick:()=>B(),children:s.jsx(he,{fontSize:"small"})})]}),sx:{left:16,bottom:16}})]})})};export{He as default};
