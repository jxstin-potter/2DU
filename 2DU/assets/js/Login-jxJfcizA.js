var ae=Object.defineProperty,se=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var z=(a,n,s)=>n in a?ae(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s,D=(a,n)=>{for(var s in n||(n={}))re.call(n,s)&&z(a,s,n[s]);if($)for(var s of $(n))ie.call(n,s)&&z(a,s,n[s]);return a},M=(a,n)=>se(a,ne(n));var C=(a,n,s)=>new Promise((j,o)=>{var u=c=>{try{r(s.next(c))}catch(x){o(x)}},m=c=>{try{r(s.throw(c))}catch(x){o(x)}},r=c=>c.done?j(c.value):Promise.resolve(c.value).then(u,m);r((s=s.apply(a,n)).next())});import{a2 as oe,a0 as O,r as p,j as e,a1 as le}from"./vendor-BwNiVhmj.js";import{u as N}from"./index-ChBqKc9D.js";import{P as ce,aa as R,B as y,T as b,d as k,ab as de,ac as ue,w as pe,A as B,ad as me,V as he,ae as xe,af as S,C as G,y as ge,z as fe,G as be,Q as U,X as ye,a as q}from"./mui-z4ihkPrE.js";import"./utils-DwmbZkdi.js";const L=me(U)(({theme:a})=>({marginBottom:"16px","& .MuiInputBase-root":{position:"relative",minHeight:"56px"},"& .MuiInputBase-input":{padding:"16px 14px","&:-webkit-autofill":{WebkitBoxShadow:a.palette.mode==="dark"?"0 0 0 100px #333 inset":"0 0 0 100px #f5f5f5 inset",WebkitTextFillColor:a.palette.text.primary,caretColor:a.palette.primary.main,borderRadius:"inherit",transition:"background-color 5000s ease-in-out 0s, color 5000s ease-in-out 0s"}},"& .MuiInputLabel-root":{"&.MuiFormLabel-filled":{transform:"translate(14px, -9px) scale(0.75)"},transition:a.transitions.create(["transform","color"],{duration:a.transitions.duration.shorter,easing:a.transitions.easing.easeOut})},"& .MuiInputBase-input:-webkit-autofill + .MuiInputLabel-root":{transform:"translate(14px, -9px) scale(0.75)",color:a.palette.primary.main}})),je=()=>{const{login:a,signup:n,loginWithGoogle:s,loginWithApple:j,requestPasswordReset:o}=N(),u=oe(),m=O(),[r,c]=p.useState(!0),[x,i]=p.useState(null),[F,f]=p.useState(null),[d,g]=p.useState(!1),[w,_]=p.useState(!0),[H,W]=p.useState(!1),[A,E]=p.useState(""),[l,Q]=p.useState({email:"",password:"",name:""}),I=p.useMemo(()=>{var h,v,T;const t=(h=m.state)==null?void 0:h.from;if(t!=null&&t.pathname){const ee=(v=t.search)!=null?v:"",te=(T=t.hash)!=null?T:"";return`${t.pathname}${ee}${te}`}return"/today"},[m.state]),V=()=>{const t=l.email.trim();return!t||!l.password?(i("Please fill in all required fields"),!1):!r&&!l.name?(i("Please enter your name"),!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?l.password.length<6?(i("Password must be at least 6 characters long"),!1):!0:(i("Please enter a valid email address"),!1)},X=t=>C(void 0,null,function*(){if(t.preventDefault(),i(null),f(null),!!V()){g(!0);try{r?yield a(l.email,l.password,w):yield n(l.email,l.password,l.name,w),u(I,{replace:!0})}catch(h){i(h instanceof Error?h.message:"An error occurred")}finally{g(!1)}}}),J=()=>C(void 0,null,function*(){i(null),f(null),g(!0);try{(yield s(w))==="success"&&u(I,{replace:!0})}catch(t){i(t instanceof Error?t.message:"Google sign-in failed")}finally{g(!1)}}),K=()=>C(void 0,null,function*(){i(null),f(null),g(!0);try{(yield j(w))==="success"&&u(I,{replace:!0})}catch(t){i(t instanceof Error?t.message:"Apple sign-in failed")}finally{g(!1)}}),P=t=>{Q(h=>M(D({},h),{[t.target.name]:t.target.value})),i(null),f(null)},Y=()=>{i(null),f(null),E(l.email.trim()),W(!0)},Z=()=>C(void 0,null,function*(){i(null),f(null);const t=A.trim();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){i("Please enter a valid email address");return}g(!0);try{yield o(t),W(!1),f("If an account exists for that email, you'll receive a password reset link shortly. If you usually sign in with Google, sign in with Google and add a password in Settings.")}catch(v){i(v instanceof Error?v.message:"Failed to send password reset email")}finally{g(!1)}});return e.jsxs(ce,{elevation:0,sx:{p:{xs:3,sm:4},width:"100%",maxWidth:380,borderRadius:3,border:t=>`1px solid ${t.palette.divider}`,bgcolor:"background.paper"},children:[e.jsxs(R,{spacing:2.25,children:[e.jsx(y,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(y,{"aria-label":"2DU",sx:{width:44,height:44,borderRadius:2,bgcolor:"#000",color:"#fff",display:"grid",placeItems:"center",fontWeight:800,letterSpacing:"-0.03em",userSelect:"none"},children:"2DU"})}),e.jsxs(y,{children:[e.jsx(b,{component:"h1",variant:"h5",align:"center",sx:{fontWeight:800},children:r?"Welcome!":"Create your account"}),e.jsx(b,{variant:"body2",align:"center",color:"text.secondary",sx:{mt:.5},children:r?"Log in to start completing tasks.":"Sign up to start completing tasks."})]}),e.jsxs(R,{spacing:1,children:[e.jsx(k,{fullWidth:!0,variant:"outlined",size:"large",startIcon:e.jsx(de,{}),onClick:J,disabled:d,sx:{borderRadius:2,textTransform:"none"},children:"Continue with Google"}),e.jsx(k,{fullWidth:!0,variant:"outlined",size:"large",startIcon:e.jsx(ue,{}),onClick:K,disabled:d,sx:{borderRadius:2,textTransform:"none"},children:"Continue with Apple"})]}),e.jsx(pe,{sx:{color:"text.secondary"},children:"OR"}),x&&e.jsx(B,{severity:"error",children:x}),F&&e.jsx(B,{severity:"success",children:F}),e.jsx(y,{component:"form",onSubmit:X,autoComplete:"on",children:e.jsxs(R,{spacing:1.5,children:[!r&&e.jsx(L,{fullWidth:!0,label:"Name",name:"name",value:l.name,onChange:P,required:!0,disabled:d,variant:"outlined",autoComplete:"name",inputProps:{autoCapitalize:"words"}}),e.jsx(L,{fullWidth:!0,label:"Email",name:"email",type:"email",value:l.email,onChange:P,required:!0,disabled:d,variant:"outlined",autoComplete:"email",inputProps:{autoCapitalize:"none",spellCheck:"false"}}),e.jsx(L,{fullWidth:!0,label:"Password",name:"password",type:"password",value:l.password,onChange:P,required:!0,disabled:d,variant:"outlined",autoComplete:r?"current-password":"new-password"}),e.jsxs(R,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mt:.25},children:[e.jsx(he,{control:e.jsx(xe,{checked:w,onChange:t=>_(t.target.checked),size:"small"}),label:e.jsx(b,{variant:"body2",children:"Remember me"})}),e.jsx(S,{component:"button",type:"button",onClick:Y,underline:"hover",sx:{fontSize:"0.875rem"},disabled:!r||d,children:"Forgot password?"})]}),e.jsx(k,{type:"submit",fullWidth:!0,variant:"contained",size:"large",sx:{mt:.5,borderRadius:2,textTransform:"none",fontWeight:700},disabled:d,children:d?e.jsx(G,{size:22,color:"inherit"}):r?"Log in":"Sign up"})]})}),e.jsx(b,{variant:"body2",color:"text.secondary",align:"center",children:r?e.jsxs(e.Fragment,{children:["Don't have an account?"," ",e.jsx(S,{component:"button",type:"button",onClick:()=>c(!1),underline:"hover",sx:{fontWeight:700},children:"Sign up"})]}):e.jsxs(e.Fragment,{children:["Already have an account?"," ",e.jsx(S,{component:"button",type:"button",onClick:()=>c(!0),underline:"hover",sx:{fontWeight:700},children:"Log in"})]})})]}),e.jsxs(ge,{open:H,onClose:()=>W(!1),"aria-labelledby":"reset-password-title",fullWidth:!0,maxWidth:"xs",children:[e.jsx(fe,{id:"reset-password-title",children:"Reset password"}),e.jsxs(be,{sx:{pt:1},children:[e.jsx(b,{variant:"body2",color:"text.secondary",sx:{mb:1.5},children:"Enter your email and we'll send you a reset link."}),e.jsx(U,{autoFocus:!0,fullWidth:!0,label:"Email",type:"email",value:A,onChange:t=>E(t.target.value),disabled:d,autoComplete:"email",inputProps:{autoCapitalize:"none",spellCheck:"false"}})]}),e.jsxs(ye,{sx:{px:3,pb:2},children:[e.jsx(k,{onClick:()=>W(!1),disabled:d,children:"Cancel"}),e.jsx(k,{variant:"contained",onClick:Z,disabled:d,children:d?e.jsx(G,{size:20,color:"inherit"}):"Send reset link"})]})]})]})},We=()=>{const{user:a,loading:n}=N(),s=O(),j=p.useMemo(()=>{var u,m,r;const o=(u=s.state)==null?void 0:u.from;if(o!=null&&o.pathname){const c=(m=o.search)!=null?m:"",x=(r=o.hash)!=null?r:"";return`${o.pathname}${c}${x}`}return"/today"},[s.state]);return!n&&a?e.jsx(le,{to:j,replace:!0}):e.jsx(y,{component:"main",sx:{height:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",px:2,py:3,overflow:"hidden",bgcolor:"background.default",backgroundImage:o=>{const u=q(o.palette.primary.main,.14),m=q(o.palette.primary.main,.08);return`radial-gradient(1200px circle at 20% 10%, ${u}, transparent 40%), radial-gradient(900px circle at 90% 80%, ${m}, transparent 40%)`}},children:e.jsxs(y,{sx:{width:"100%",maxWidth:420},children:[e.jsx(je,{}),e.jsxs(b,{variant:"caption",color:"text.secondary",sx:{display:"block",textAlign:"center",mt:2},children:["By continuing you agree to our"," ",e.jsx(S,{href:"#",underline:"hover",color:"inherit",children:"Terms"})," ","and"," ",e.jsx(S,{href:"#",underline:"hover",color:"inherit",children:"Privacy Policy"}),"."]})]})})};export{We as default};
