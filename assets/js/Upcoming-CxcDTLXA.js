var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var W=(t,e,o)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,Y=(t,e)=>{for(var o in e||(e={}))se.call(e,o)&&W(t,o,e[o]);if(B)for(var o of B(e))oe.call(e,o)&&W(t,o,e[o]);return t},R=(t,e)=>te(t,ae(e));var S=(t,e,o)=>new Promise((f,p)=>{var h=m=>{try{i(o.next(m))}catch(r){p(r)}},u=m=>{try{i(o.throw(m))}catch(r){p(r)}},i=m=>m.done?f(m.value):Promise.resolve(m.value).then(h,u);i((o=o.apply(t,e)).next())});import{V,A as s,H as I,T as D,K as G,bl as ne,bm as H,bn as re,bo as ce,bp as ie,bq as le,r as l,bd as de,a8 as ue,S as me,a7 as he,bk as pe}from"./vendor-Ch348d4r.js";import{u as ke,d as fe,l as ge}from"./index-DR31qAIW.js";import{T as xe,a as ye,b as Te}from"./TaskDetailModal-Q58joVWi.js";import{D as F,H as be,B as _e,b as Ce,e as N,w as we}from"./utils-BdZxPcI9.js";import{s as De,t as q,u as K,d as je,c as Se,a as Ie}from"./tasksService-BrK5NF1i.js";const ve="_container_lkqmh_1",Ee="_iconToday_lkqmh_81 _iconContainer_lkqmh_37",Me="_iconUpcoming_lkqmh_91 _iconContainer_lkqmh_37",Ne="_iconCompleted_lkqmh_101 _iconContainer_lkqmh_37",Ae="_iconTags_lkqmh_111 _iconContainer_lkqmh_37",Ue="_iconCalendar_lkqmh_121 _iconContainer_lkqmh_37",qe="_title_lkqmh_131",Fe="_description_lkqmh_145",x={container:ve,iconToday:Ee,iconUpcoming:Me,iconCompleted:Ne,iconTags:Ae,iconCalendar:Ue,title:qe,description:Fe},$e=({type:t,onCreateTask:e})=>{const o=V(),f=()=>{switch(t){case"today":return x.iconToday;case"upcoming":return x.iconUpcoming;case"completed":return x.iconCompleted;case"tags":return x.iconTags;case"calendar":return x.iconCalendar;default:return x.iconToday}},p=()=>{const i={fontSize:60,color:t==="completed"?o.palette.success.main:o.palette.primary.main};switch(t){case"today":return s.jsx(H,{sx:i});case"upcoming":return s.jsx(le,{sx:i});case"completed":return s.jsx(ie,{sx:i});case"tags":return s.jsx(ce,{sx:i});case"calendar":return s.jsx(re,{sx:i});default:return s.jsx(H,{sx:i})}},h=()=>{switch(t){case"today":return"No tasks for today";case"upcoming":return"No upcoming tasks";case"completed":return"No completed tasks";case"tags":return"No tagged tasks";case"calendar":return"No tasks scheduled";default:return"No tasks"}},u=()=>{switch(t){case"today":return"You have no tasks scheduled for today. Add a new task to get started.";case"upcoming":return"You have no upcoming tasks. Plan ahead by adding tasks with future due dates.";case"completed":return"You haven't completed any tasks yet. Complete tasks to see them here.";case"tags":return"You haven't tagged any tasks yet. Add tags to your tasks to organize them.";case"calendar":return"You have no tasks scheduled. Add tasks with due dates to see them in your calendar.";default:return"You have no tasks. Add a new task to get started."}};return s.jsxs(I,{className:x.container,sx:{borderColor:o.palette.divider,backgroundColor:o.palette.mode==="dark"?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)"},children:[s.jsx("div",{className:f(),children:p()}),s.jsx(D,{variant:"h5",className:x.title,sx:{color:o.palette.text.primary,mb:.5},children:h()}),s.jsx(D,{variant:"body2",className:x.description,sx:{color:o.palette.text.secondary,mb:3,maxWidth:"400px"},children:u()}),e&&s.jsx(G,{variant:"contained",color:"primary",startIcon:s.jsx(ne,{}),onClick:e,sx:{borderRadius:"6px","&:hover":{transform:"translateY(-2px)",boxShadow:o.shadows[4]}},children:"Add New Task"})]})};function L(t){return N(t,"yyyy-MM-dd")}function Oe(t,e){const o=N(t,"MMM d");return we(t,e)?`${o} ‧ Today ‧ ${N(t,"EEEE")}`:`${o} ‧ ${N(t,"EEEE")}`}function w(t){return F(new Date(t))}function Pe(t){return t.completed!==!0&&t.dueDate!=null}function ze(t,e){var m;const o=F(new Date),f=w(e.startDate),p=t.filter(Pe);let h=w(be(e.focusedMonth));for(const r of p){const k=w(r.dueDate);k.getTime()>h.getTime()&&(h=k)}const u=new Map;for(const r of p){const k=w(r.dueDate);if(_e(k,f))continue;const c=L(k),g=u.get(c);g?g.push(r):u.set(c,[r])}const i=[];for(let r=f;r.getTime()<=h.getTime();r=Ce(r,1)){const k=L(r),c=(m=u.get(k))!=null?m:[];c.length!==0&&(c.sort((g,y)=>{var _,C;const A=w(g.dueDate).getTime(),j=w(y.dueDate).getTime();if(A!==j)return A-j;const v=(_=g.order)!=null?_:Number.POSITIVE_INFINITY,b=(C=y.order)!=null?C:Number.POSITIVE_INFINITY;return v!==b?v-b:g.title.localeCompare(y.title)}),i.push({key:k,kind:"day",title:Oe(r,o),date:r,anchorId:`selection-${k}`,tasks:c}))}return i}const Ve=()=>{const t=V(),{user:e,loading:o}=ke(),{isOpen:f,openModal:p,closeModal:h}=fe(),[u,i]=l.useState([]),[m,r]=l.useState(!0),[k,c]=l.useState(null),[g,y]=l.useState(null),[A,j]=l.useState(null),[v,b]=l.useState(!1),[_,C]=l.useState(null),E=l.useRef(0);l.useEffect(()=>{if(!(e!=null&&e.id)){i([]),r(!1),E.current=0;return}r(!0),c(null),E.current=0;const n=De(e.id,{completionStatus:"all",sortBy:"creationDate",sortOrder:"desc"},a=>{try{const d=a.tasks.length;if(d===0&&E.current>0)return;E.current=d;const U=a.tasks.map(T=>{var z;try{return Ie(T)}catch(Be){return{id:T.id||"",title:T.title||"Untitled Task",completed:(z=T.completed)!=null?z:!1,userId:T.userId||"",createdAt:new Date,updatedAt:new Date}}});i(U),a.fromServer!==!1&&r(!1),c(null)}catch(d){c("Failed to process tasks"),r(!1)}});return()=>n()},[e==null?void 0:e.id]);const M=l.useCallback(n=>S(void 0,null,function*(){if(!(e!=null&&e.id)){c("Please log in to toggle tasks");return}try{const a=u.find(T=>T.id===n);if(!a)return;const d=!a.completed,U=q({completed:d});yield K(n,U,e.id),d&&(C(n),b(!0))}catch(a){c(a instanceof Error?a.message:"Failed to toggle task status")}}),[u,e==null?void 0:e.id]),J=l.useCallback(()=>{_&&(M(_),b(!1),C(null))},[_,M]),$=l.useCallback((n,a)=>{a!=="clickaway"&&(b(!1),C(null))},[]),Q=l.useCallback(n=>S(void 0,null,function*(){if(!(e!=null&&e.id)){c("Please log in to delete tasks");return}try{yield je(n,e.id)}catch(a){c(a instanceof Error?a.message:"Failed to delete task")}}),[e==null?void 0:e.id]),O=l.useCallback((n,a)=>S(void 0,null,function*(){if(!(e!=null&&e.id)){c("Please log in to update tasks");return}try{const d=q(a);yield K(n,d,e.id)}catch(d){c(d instanceof Error?d.message:"Failed to update task")}}),[e==null?void 0:e.id]),X=l.useCallback(n=>S(void 0,null,function*(){try{if(o)throw new Error("Please wait for authentication to complete");if(!(e!=null&&e.id))throw new Error("Please log in to create tasks");const a=q(R(Y({},n),{userId:e.id,completed:!1,order:u.length})),d=yield Se(e.id,a);j(d),setTimeout(()=>j(null),600),y(null),h()}catch(a){const d=a instanceof Error?a.message:"Failed to create task";throw c(d),ge.error("Failed to create task",{action:"createTask"},a),a}}),[o,h,u.length,e==null?void 0:e.id]),P=l.useMemo(()=>{const n=u.filter(a=>!a.completed&&a.dueDate!=null);return ze(n,{focusedMonth:new Date,startDate:F(new Date)})},[u]),Z=P.some(n=>n.tasks.length>0);return s.jsx(I,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"flex-start",width:"100%",px:{xs:2,sm:0},ml:{xs:0,sm:-1},mt:-.5},children:s.jsxs(de,{maxWidth:"md",disableGutters:!0,sx:{width:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[s.jsxs(I,{sx:{width:"100%",maxWidth:{xs:"100%",sm:t.breakpoints.values.sm}},children:[s.jsxs(I,{sx:{mb:2},children:[s.jsx(D,{variant:"h5",component:"h1",sx:{fontWeight:t.typography.fontWeightBold,mb:.5},children:"Upcoming"}),s.jsx(D,{variant:"body2",color:"text.secondary",children:"Tasks with due dates, grouped by day."})]}),!m&&!Z?s.jsx($e,{type:"upcoming",onCreateTask:()=>p()}):P.map(n=>s.jsxs(I,{id:n.anchorId,sx:{mb:3},children:[s.jsx(D,{variant:"h6",sx:{fontWeight:t.typography.fontWeightBold,fontSize:t.typography.body1.fontSize,mb:1.5,color:"text.secondary"},children:n.title}),n.tasks.length===0?s.jsx(D,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"No tasks"}):s.jsx(ue,{sx:{py:0},children:n.tasks.map(a=>s.jsx(xe,{task:a,onToggleComplete:()=>M(a.id),onDelete:()=>Q(a.id),onEdit:()=>{y(a),p()},onUpdate:O,isActionInProgress:!1},a.id))})]},n.key))]}),g?s.jsx(ye,{open:f,onClose:()=>{h(),y(null)},task:g,onUpdate:O,onToggleComplete:M}):s.jsx(Te,{open:f,onClose:()=>{h(),y(null)},onSubmit:X,initialTask:null,loading:m}),s.jsx(me,{open:v,anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:15e3,onClose:$,message:"1 task completed",action:s.jsxs(s.Fragment,{children:[s.jsx(G,{color:"inherit",size:"small",onClick:J,children:"Undo"}),s.jsx(he,{size:"small","aria-label":"Close",color:"inherit",onClick:()=>$(),children:s.jsx(pe,{fontSize:"small"})})]}),sx:{left:16,bottom:16}})]})})};export{Ve as default};
