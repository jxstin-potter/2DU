var ge=Object.defineProperty,ye=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var ie=(p,t,s)=>t in p?ge(p,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[t]=s,re=(p,t)=>{for(var s in t||(t={}))je.call(t,s)&&ie(p,s,t[s]);if(ae)for(var s of ae(t))ke.call(t,s)&&ie(p,s,t[s]);return p},le=(p,t)=>ye(p,be(t));var F=(p,t,s)=>new Promise((y,S)=>{var n=x=>{try{M(s.next(x))}catch(h){S(h)}},W=x=>{try{M(s.throw(x))}catch(h){S(h)}},M=x=>x.done?y(x.value):Promise.resolve(x.value).then(n,W);M((s=s.apply(p,t)).next())});import{V as he,aC as Te,r as a,A as e,H as i,T as C,a0 as Ce,a7 as Z,be as $,bf as ee,bg as te,bh as de,bi as Se,bj as oe,bb as ce,S as we,K as ve,bk as De}from"./vendor-CbdQs_1R.js";import{c as Ee,d as xe,u as Ie,l as Me}from"./index-B5I4Nid2.js";import{s as ze,t as se,u as me,d as Oe,c as Be,a as Fe}from"./tasksService-GERJMSHX.js";import{T as ne,I as ue,a as We,b as Re}from"./TaskDetailModal-C0D5rEOJ.js";import{T as pe}from"./TodayAddTaskButton-R7je0OHI.js";import{D as L,B as Ue,e as Pe}from"./utils-BuwBnmRf.js";const He=({tasks:p,justAddedTaskId:t=null,onTaskAction:s,onCreateTask:y,defaultCategoryId:S})=>{const n=he(),{categories:W}=Ee(),x=Te(n.breakpoints.down("sm"))?56:64,{closeModal:h}=xe(),[J,f]=a.useState(!0),[b,R]=a.useState(!1),[A,N]=a.useState(!0),[Y,w]=a.useState(!1),[k,U]=a.useState(()=>L(new Date)),[z,O]=a.useState(null);a.useEffect(()=>{const o=()=>{const T=new Date,E=new Date(T);E.setHours(24,0,0,0);const X=E.getTime()-T.getTime();return window.setTimeout(()=>{U(L(new Date)),m.current=o()},X)},m={current:o()},u=()=>{if(document.visibilityState==="visible"){const T=L(new Date);U(E=>E.getTime()===T.getTime()?E:T)}};return document.addEventListener("visibilitychange",u),()=>{clearTimeout(m.current),document.removeEventListener("visibilitychange",u)}},[]);const v=a.useCallback(o=>F(void 0,null,function*(){y&&(yield y(o),w(!1),h())}),[y,h]),G=a.useCallback(()=>{w(!1),h()},[h]),{overdueTasks:V,todayTasks:K,todayIncomplete:B,todayCompleted:P,taskCount:H,tasksForSummary:D}=a.useMemo(()=>{const o=[],m=[];let u=0;p.forEach(c=>{if(!c.dueDate)return;const I=L(new Date(c.dueDate));Ue(I,k)?(o.push(c),c.completed||u++):I.getTime()===k.getTime()&&(m.push(c),c.completed||u++)});const T=o.filter(c=>!c.completed);T.sort((c,I)=>!c.dueDate||!I.dueDate?0:new Date(c.dueDate).getTime()-new Date(I.dueDate).getTime()),m.sort((c,I)=>c.completed!==I.completed?c.completed?1:-1:new Date(c.createdAt).getTime()-new Date(I.createdAt).getTime());const E=m.filter(c=>!c.completed),X=m.filter(c=>c.completed&&L(new Date(c.updatedAt)).getTime()===k.getTime()),fe=[...T,...E,...X];return{overdueTasks:T,todayTasks:m,todayIncomplete:E,todayCompleted:X,taskCount:u,tasksForSummary:fe}},[p,k]),Q=Pe(k,"MMM d 'Today' - EEEE"),q={low:"#4caf50",medium:"#ff9800",high:"#f44336"},l=o=>{const m=W.find(u=>u.id===o.categoryId);return m!=null&&m.color?m.color:o.priority&&q[o.priority]?q[o.priority]:n.palette.error.main},r=9,d=D.slice(0,r),j=Math.max(0,D.length-r),g=!!z,_=g?"today-summary-more-popover":void 0;return e.jsxs(i,{sx:{width:"100%"},children:[e.jsxs(i,{sx:{position:"sticky",top:x,zIndex:10,backgroundColor:"background.default",borderBottom:1,borderColor:"divider",pb:2,mb:4},children:[e.jsx(C,{component:"h1",variant:"h6",sx:{fontWeight:700,mb:.5,fontSize:"1.5rem",lineHeight:1.3},children:"Today"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5,mb:D.length>0?1:1.5},children:[e.jsx(Ce,{sx:{fontSize:"0.75rem",color:"text.secondary"}}),e.jsxs(C,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:[H," ",H===1?"task":"tasks"]}),D.length>0&&e.jsx(Z,{size:"small",onClick:()=>N(o=>!o),"aria-label":A?"Hide task list":"Show task list",sx:{p:.25,minWidth:0,color:"text.disabled","&:hover":{color:"text.secondary",backgroundColor:"transparent"}},children:A?e.jsx($,{sx:{fontSize:"1rem"}}):e.jsx(ee,{sx:{fontSize:"1rem"}})})]}),D.length>0&&e.jsx(te,{in:A,children:e.jsxs(i,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:.5,fontSize:"0.8125rem",color:"text.secondary",maxHeight:48,overflow:"hidden",mb:1},children:[d.map(o=>e.jsxs(i,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:.75,mr:1.25,flexShrink:0},children:[e.jsx(i,{component:"span",sx:{width:3,height:10,borderRadius:.5,flexShrink:0,backgroundColor:l(o)}}),e.jsxs(C,{component:"span",variant:"body2",sx:{fontSize:"0.8125rem",color:"text.secondary",textDecoration:o.completed?"line-through":"none"},children:[o.completed?"✓ ":"",o.title]})]},o.id)),j>0&&e.jsx(de,{onClick:o=>O(o.currentTarget),"aria-describedby":_,sx:{borderRadius:.75,px:.75,py:.25,lineHeight:1.2,color:"text.disabled","&:hover":{color:"text.secondary",backgroundColor:"action.hover"}},children:e.jsxs(C,{component:"span",variant:"body2",sx:{fontSize:"0.8125rem",color:"inherit"},children:[j," more"]})})]})})]}),e.jsx(Se,{id:_,open:g,anchorEl:z,onClose:()=>O(null),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{mt:.5,borderRadius:2,minWidth:280,maxWidth:420,boxShadow:n.shadows[6]}},children:e.jsx(i,{sx:{py:.5,maxHeight:360,overflowY:"auto"},children:D.map(o=>e.jsxs(de,{onClick:()=>{O(null),s.edit(o)},sx:{width:"100%",textAlign:"left",px:1.5,py:.75,display:"flex",alignItems:"center",gap:1,"&:hover":{backgroundColor:"action.hover"}},children:[e.jsx(i,{sx:{width:3,height:14,borderRadius:.75,flexShrink:0,backgroundColor:l(o)}}),e.jsxs(C,{variant:"body2",sx:{fontSize:"0.875rem",color:"text.primary",textDecoration:o.completed?"line-through":"none"},children:[o.completed?"✓ ":"",o.title]})]},o.id))})}),V.length>0&&e.jsxs(i,{sx:{mb:n.spacing(3)},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:n.spacing(1)},children:[e.jsx(Z,{size:"small",onClick:()=>f(!J),sx:{p:n.spacing(.5)},children:J?e.jsx($,{fontSize:"small"}):e.jsx(ee,{fontSize:"small"})}),e.jsx(C,{variant:"h6",sx:{fontWeight:n.typography.fontWeightBold,fontSize:n.typography.body1.fontSize},children:"Overdue"})]}),e.jsx(te,{in:J,children:e.jsx(i,{children:V.map(o=>{const m=o.id===t,u=e.jsx(ne,{task:o,onToggleComplete:s.toggle,onDelete:s.delete,onEdit:s.edit,onUpdate:s.update},o.id);return m?e.jsx(oe.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},children:u},o.id):u})})})]}),e.jsxs(i,{children:[e.jsx(C,{variant:"h6",sx:{fontWeight:n.typography.fontWeightBold,fontSize:n.typography.body1.fontSize,mb:n.spacing(2)},children:Q}),K.length>0?e.jsxs(e.Fragment,{children:[B.map(o=>{const m=o.id===t,u=e.jsx(ne,{task:o,onToggleComplete:s.toggle,onDelete:s.delete,onEdit:s.edit,onUpdate:s.update},o.id);return m?e.jsx(oe.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},children:u},o.id):u}),Y&&y?e.jsx(i,{sx:{mt:n.spacing(2),mb:n.spacing(1)},children:e.jsx(ue,{onSubmit:v,onCancel:G,defaultCategoryId:S})}):e.jsx(i,{sx:{mt:n.spacing(.5),width:"100%"},children:e.jsx(pe,{onClick:()=>w(!0)})}),P.length>0&&e.jsxs(i,{sx:{mt:n.spacing(2),mb:n.spacing(1)},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:n.spacing(1)},children:[e.jsx(Z,{size:"small",onClick:()=>R(!b),sx:{p:n.spacing(.5)},children:b?e.jsx($,{fontSize:"small"}):e.jsx(ee,{fontSize:"small"})}),e.jsxs(C,{variant:"h6",sx:{fontWeight:n.typography.fontWeightBold,fontSize:n.typography.body1.fontSize},children:["Completed (",P.length,")"]})]}),e.jsx(te,{in:b,children:e.jsx(i,{children:P.map(o=>{const m=o.id===t,u=e.jsx(ne,{task:o,onToggleComplete:s.toggle,onDelete:s.delete,onEdit:s.edit,onUpdate:s.update},o.id);return m?e.jsx(oe.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},children:u},o.id):u})})})]})]}):e.jsx(i,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:n.spacing(1.5)},children:Y&&y?e.jsx(ue,{onSubmit:v,onCancel:G,defaultCategoryId:S}):e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"body2",color:"text.secondary",sx:{fontSize:n.typography.body2.fontSize,mb:1},children:"No tasks for today"}),e.jsx(i,{sx:{width:"100%"},children:e.jsx(pe,{onClick:()=>w(!0)})})]})})]})]})},Ge=()=>{const p=he(),{user:t,loading:s}=Ie(),{isOpen:y,openModal:S,closeModal:n}=xe(),[W,M]=a.useState([]),[x,h]=a.useState(!0),[J,f]=a.useState(null),[b,R]=a.useState(null),[A,N]=a.useState(null),[Y,w]=a.useState(!1),[k,U]=a.useState(null),z=a.useRef(0),O=a.useRef([]);O.current=W,a.useEffect(()=>{if(!(t!=null&&t.id)){M([]),h(!1),z.current=0;return}h(!0),f(null),z.current=0;const l=ze(t.id,{completionStatus:"all",sortBy:"creationDate",sortOrder:"desc"},r=>{try{const d=r.tasks.length;if(d===0&&z.current>0)return;z.current=d;const j=r.tasks.map(g=>{var _;try{return Fe(g)}catch(o){return{id:g.id||"",title:g.title||"Untitled Task",completed:(_=g.completed)!=null?_:!1,userId:g.userId||"",createdAt:new Date,updatedAt:new Date}}});M(j),h(!1),f(null)}catch(d){f("Failed to process tasks"),h(!1)}});return()=>{l()}},[t==null?void 0:t.id]);const v=a.useCallback(l=>F(void 0,null,function*(){if(!(t!=null&&t.id)){f("Please log in to toggle tasks");return}try{const r=O.current.find(g=>g.id===l);if(!r)return;const d=!r.completed,j=se({completed:d});yield me(l,j,t.id),d&&(U(l),w(!0))}catch(r){f(r instanceof Error?r.message:"Failed to toggle task status")}}),[t==null?void 0:t.id]),G=a.useCallback(()=>{k&&(v(k),w(!1),U(null))},[k,v]),V=a.useCallback((l,r)=>{r!=="clickaway"&&(w(!1),U(null))},[]),K=a.useCallback(l=>F(void 0,null,function*(){if(!(t!=null&&t.id)){f("Please log in to delete tasks");return}try{yield Oe(l,t.id)}catch(r){f(r instanceof Error?r.message:"Failed to delete task")}}),[t==null?void 0:t.id]),B=a.useCallback((l,r)=>F(void 0,null,function*(){if(!(t!=null&&t.id)){f("Please log in to update tasks");return}try{const d=se(r);yield me(l,d,t.id)}catch(d){f(d instanceof Error?d.message:"Failed to update task")}}),[t==null?void 0:t.id]),P=a.useCallback(l=>{R(l),S()},[S]),H=a.useCallback(l=>F(void 0,null,function*(){var r;try{if(s)throw new Error("Please wait for authentication to complete");if(!(t!=null&&t.id))throw new Error("Please log in to create tasks");const d=(r=l.dueDate)!=null?r:L(new Date),j=se(le(re({},l),{dueDate:d,userId:t.id,completed:!1,order:O.current.length})),g=yield Be(t.id,j);N(g),setTimeout(()=>N(null),600),R(null),n()}catch(d){const j=d instanceof Error?d.message:"Failed to create task";throw f(j),Me.error("Failed to create task",{action:"createTask"},d),d}}),[s,t==null?void 0:t.id,n]),D=a.useMemo(()=>({toggle:v,delete:K,update:B,edit:P}),[v,K,B,P]),Q=a.useCallback(()=>{n(),R(null)},[n]),q=a.useMemo(()=>b?l=>F(void 0,null,function*(){b.id&&(yield B(b.id,l),n(),R(null))}):H,[b,B,n,H]);return x?e.jsx(ce,{maxWidth:"lg",children:e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"})}):e.jsx(i,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"flex-start",width:"100%",pl:0,ml:-1,mt:-.5},children:e.jsxs(ce,{maxWidth:"md",disableGutters:!0,sx:{width:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx(i,{sx:{width:"100%",maxWidth:p.breakpoints.values.sm},children:e.jsx(He,{tasks:W,justAddedTaskId:A,onTaskAction:D,onCreateTask:H})}),b?e.jsx(We,{open:y,onClose:Q,task:b,onUpdate:B,onToggleComplete:v}):e.jsx(Re,{open:y,onClose:Q,onSubmit:q,initialTask:null,loading:x}),e.jsx(we,{open:Y,anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:15e3,onClose:V,message:"1 task completed",action:e.jsxs(e.Fragment,{children:[e.jsx(ve,{color:"inherit",size:"small",onClick:G,children:"Undo"}),e.jsx(Z,{size:"small","aria-label":"Close",color:"inherit",onClick:()=>V(),children:e.jsx(De,{fontSize:"small"})})]}),sx:{left:16,bottom:16}})]})})};export{Ge as default};
