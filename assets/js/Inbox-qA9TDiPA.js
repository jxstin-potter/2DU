var q=Object.defineProperty,X=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var _=(o,e,a)=>e in o?q(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,H=(o,e)=>{for(var a in e||(e={}))$.call(e,a)&&_(o,a,e[a]);if(W)for(var a of W(e))ee.call(e,a)&&_(o,a,e[a]);return o},V=(o,e)=>X(o,Z(e));var b=(o,e,a)=>new Promise((u,i)=>{var d=c=>{try{x(a.next(c))}catch(f){i(f)}},h=c=>{try{x(a.throw(c))}catch(f){i(f)}},x=c=>c.done?u(c.value):Promise.resolve(c.value).then(d,h);x((a=a.apply(o,e)).next())});import{V as Y,aC as te,r as t,A as s,H as C,T as ae,bj as se,bb as J,S as oe,K as ne,a7 as le,bk as re}from"./vendor-CbdQs_1R.js";import{d as G,u as ie,l as de}from"./index-B5I4Nid2.js";import{s as ce,t as B,u as L,d as ue,c as me,a as fe}from"./tasksService-GERJMSHX.js";import{T as pe,I as ke,a as he,b as Te}from"./TaskDetailModal-C0D5rEOJ.js";import{T as xe}from"./TodayAddTaskButton-R7je0OHI.js";import"./utils-BuwBnmRf.js";function ge(o,e){const a=o.dueDate?new Date(o.dueDate).getTime():Number.POSITIVE_INFINITY,u=e.dueDate?new Date(e.dueDate).getTime():Number.POSITIVE_INFINITY;if(a!==u)return a-u;const i=o.createdAt?new Date(o.createdAt).getTime():0,d=e.createdAt?new Date(e.createdAt).getTime():0;return i!==d?i-d:o.id.localeCompare(e.id)}const be=({tasks:o,loading:e=!1,justAddedTaskId:a=null,onTaskAction:u,onCreateTask:i,defaultCategoryId:d})=>{const h=Y(),c=te(h.breakpoints.down("sm"))?56:64,{isOpen:f,closeModal:I}=G(),[k,p]=t.useState(!1);t.useEffect(()=>{f&&p(!1)},[f]);const w=t.useCallback(m=>b(void 0,null,function*(){i&&(yield i(m),p(!1),I())}),[i,I]),A=t.useCallback(()=>{p(!1),I()},[I]),{activeTasks:D}=t.useMemo(()=>{const m=[];return o.forEach(T=>{T.completed||m.push(T)}),m.sort(ge),{activeTasks:m}},[o]);return s.jsxs(C,{sx:{width:"100%"},children:[s.jsx(C,{sx:{position:"sticky",top:c,zIndex:10,backgroundColor:"background.default",borderBottom:1,borderColor:"divider",pb:2,mb:3},children:s.jsx(ae,{component:"h1",variant:"h6",sx:{fontWeight:700,mb:.5,fontSize:"1.5rem",lineHeight:1.3},children:"Inbox"})}),D.map(m=>{const T=m.id===a,y=s.jsx(pe,{task:m,onToggleComplete:u.toggle,onDelete:u.delete,onEdit:u.edit,onUpdate:u.update,isActionInProgress:e,showPriorityRing:!0},m.id);return T?s.jsx(se.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},children:y},m.id):y}),k&&i?s.jsx(C,{sx:{mt:h.spacing(2),mb:h.spacing(1)},children:s.jsx(ke,{onSubmit:w,onCancel:A,defaultCategoryId:d})}):s.jsx(C,{sx:{mt:h.spacing(.5),width:"100%"},children:s.jsx(xe,{onClick:()=>p(!0)})})]})},Me=()=>{const o=Y(),{user:e,loading:a}=ie(),{isOpen:u,openModal:i,closeModal:d}=G(),[h,x]=t.useState([]),[c,f]=t.useState(!0),[I,k]=t.useState(null),[p,w]=t.useState(null),[A,D]=t.useState(null),[m,T]=t.useState(!1),[y,F]=t.useState(null),E=t.useRef(0),O=t.useRef([]);O.current=h,t.useEffect(()=>{if(!(e!=null&&e.id)){x([]),f(!1),E.current=0;return}f(!0),k(null),E.current=0;const l=ce(e.id,{completionStatus:"all",sortBy:"creationDate",sortOrder:"desc"},n=>{try{const r=n.tasks.length;if(r===0&&E.current>0)return;E.current=r;const v=n.tasks.map(g=>{var R;try{return fe(g)}catch(Ce){return{id:g.id||"",title:g.title||"Untitled Task",completed:(R=g.completed)!=null?R:!1,userId:g.userId||"",createdAt:new Date,updatedAt:new Date}}});x(v),f(!1),k(null)}catch(r){k("Failed to process tasks"),f(!1)}});return()=>l()},[e==null?void 0:e.id]);const j=t.useCallback(l=>b(void 0,null,function*(){if(!(e!=null&&e.id)){k("Please log in to toggle tasks");return}try{const n=O.current.find(g=>g.id===l);if(!n)return;const r=!n.completed,v=B({completed:r});yield L(l,v,e.id),r&&(F(l),T(!0))}catch(n){k(n instanceof Error?n.message:"Failed to toggle task status")}}),[e==null?void 0:e.id]),K=t.useCallback(()=>{y&&(j(y),T(!1),F(null))},[y,j]),P=t.useCallback((l,n)=>{n!=="clickaway"&&(T(!1),F(null))},[]),U=t.useCallback(l=>b(void 0,null,function*(){if(e!=null&&e.id)try{yield ue(l,e.id)}catch(n){k(n instanceof Error?n.message:"Failed to delete task")}}),[e==null?void 0:e.id]),S=t.useCallback((l,n)=>b(void 0,null,function*(){if(e!=null&&e.id)try{const r=B(n);yield L(l,r,e.id)}catch(r){k(r instanceof Error?r.message:"Failed to update task")}}),[e==null?void 0:e.id]),z=t.useCallback(l=>{w(l),i()},[i]),M=t.useCallback(l=>b(void 0,null,function*(){try{if(a)throw new Error("Please wait for authentication to complete");if(!(e!=null&&e.id))throw new Error("Please log in to create tasks");const n=B(V(H({},l),{userId:e.id,completed:!1,order:O.current.length})),r=yield me(e.id,n);D(r),setTimeout(()=>D(null),600),w(null),d()}catch(n){const r=n instanceof Error?n.message:"Failed to create task";throw k(r),de.error("Failed to create task",{action:"createTask"},n),n}}),[a,e==null?void 0:e.id,d]),Q=t.useMemo(()=>({toggle:j,delete:U,update:S,edit:z}),[j,U,S,z]),N=t.useCallback(()=>{d(),w(null)},[d]);return t.useMemo(()=>p?l=>b(void 0,null,function*(){p.id&&(yield S(p.id,l),d(),w(null))}):M,[p,S,d,M]),c?s.jsx(J,{maxWidth:"lg",children:s.jsx(C,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"})}):s.jsx(C,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"flex-start",width:"100%",pl:0,ml:-1,mt:-.5},children:s.jsxs(J,{maxWidth:"md",disableGutters:!0,sx:{width:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[s.jsx(C,{sx:{width:"100%",maxWidth:o.breakpoints.values.sm},children:s.jsx(be,{tasks:h,loading:c,justAddedTaskId:A,onTaskAction:Q,onCreateTask:M})}),p?s.jsx(he,{open:u,onClose:N,task:p,onUpdate:S,onToggleComplete:j}):s.jsx(Te,{open:u,onClose:N,onSubmit:M,initialTask:null,loading:c}),s.jsx(oe,{open:m,anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:15e3,onClose:P,message:"1 task completed",action:s.jsxs(s.Fragment,{children:[s.jsx(ne,{color:"inherit",size:"small",onClick:K,children:"Undo"}),s.jsx(le,{size:"small","aria-label":"Close",color:"inherit",onClick:()=>P(),children:s.jsx(re,{fontSize:"small"})})]}),sx:{left:16,bottom:16}})]})})};export{Me as default};
