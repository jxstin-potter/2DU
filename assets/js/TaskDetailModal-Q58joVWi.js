var st=Object.defineProperty,lt=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var Le=(r,l,t)=>l in r?st(r,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[l]=t,ne=(r,l)=>{for(var t in l||(l={}))ct.call(l,t)&&Le(r,t,l[t]);if(Be)for(var t of Be(l))dt.call(l,t)&&Le(r,t,l[t]);return r},he=(r,l)=>lt(r,it(l));var de=(r,l,t)=>new Promise((a,i)=>{var d=b=>{try{o(t.next(b))}catch(A){i(A)}},p=b=>{try{o(t.throw(b))}catch(A){i(A)}},o=b=>b.done?a(b.value):Promise.resolve(b.value).then(d,p);o((t=t.apply(r,l)).next())});import{V as ie,r as n,A as e,bv as ut,bw as pt,bx as xt,by as mt,bz as ft,bi as qe,H as h,h as x,T as se,a8 as Ge,a1 as Ve,a3 as ye,a4 as xe,aQ as Te,aR as ke,bA as ht,bB as gt,bC as bt,br as je,Y as Ne,K as me,bD as be,ac as Ee,ad as ce,bE as Fe,bb as Ye,bF as yt,P as jt,bG as _e,bo as vt,bl as Dt,bH as Ct,bj as wt,bI as Xe,am as St,ar as Oe,a7 as pe,bJ as He,bK as It,bL as Je,a2 as De,bM as Ze,bN as Mt,bO as zt,bP as At,ai as Ue,al as et,aY as Pt,I as Et,ba as Rt,bc as Tt,au as Re,N as kt,X as Ot,an as Wt,ao as Bt,bQ as Lt,ak as Nt,b0 as Ft,bR as _t,a9 as Ht}from"./vendor-Ch348d4r.js";import{D as le,b as Ce,e as ue,ad as $e,ae as Ke,ab as tt,B as $t}from"./utils-BdZxPcI9.js";import{c as ve,_ as Kt,l as Qt,d as qt}from"./index-DR31qAIW.js";const we={low:"Low",medium:"Medium",high:"High"},ge=r=>{switch(r){case"low":return"#4A9B6D";case"medium":return"#B8954A";case"high":return"#B85C5C"}},rt=({anchorEl:r,value:l,onClose:t,onChange:a})=>{const i=ie(),d=le(new Date),p=n.useMemo(()=>[{id:"tomorrow",label:"Tomorrow",sublabel:ue(Ce(d,1),"EEE"),icon:e.jsx(ut,{sx:{fontSize:"1rem"}}),getDate:()=>Ce(d,1)},{id:"later",label:"Later this week",sublabel:ue(Ce(d,2),"EEE"),icon:e.jsx(pt,{sx:{fontSize:"1rem"}}),getDate:()=>Ce(d,2)},{id:"weekend",label:"This weekend",sublabel:ue($e(d),"EEE"),icon:e.jsx(xt,{sx:{fontSize:"1rem"}}),getDate:()=>$e(d)},{id:"nextweek",label:"Next week",sublabel:ue(Ke(d),"EEE MMM d"),icon:e.jsx(mt,{sx:{fontSize:"1rem"}}),getDate:()=>Ke(d)},{id:"none",label:"No Date",sublabel:"",icon:e.jsx(ft,{sx:{fontSize:"1rem"}}),getDate:()=>null}],[d]),b=ue(l||d,"MMM d"),A=y=>{a(y.getDate()),y.id==="none"&&t()},$=y=>{a(y?le(y):null)};return e.jsxs(qe,{open:!!r,anchorEl:r,onClose:t,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{mt:1,p:0,minWidth:{xs:"calc(100vw - 32px)",sm:320},maxWidth:{xs:"calc(100vw - 32px)",sm:360},borderRadius:2,boxShadow:i.palette.mode==="dark"?"0 8px 32px rgba(0, 0, 0, 0.4)":"0 8px 32px rgba(0, 0, 0, 0.12)",overflow:"hidden"}},children:[e.jsx(h,{sx:{px:2,py:1.25,bgcolor:x(i.palette.text.primary,.06)},children:e.jsx(se,{variant:"subtitle2",sx:{fontWeight:600,fontSize:"0.875rem"},children:b})}),e.jsx(Ge,{dense:!0,disablePadding:!0,sx:{py:.5},children:p.map(y=>{const w=y.getDate(),D=y.id==="none"?!l:!!(l&&w&&le(w).getTime()===le(l).getTime());return e.jsxs(Ve,{button:!0,onClick:()=>A(y),sx:{py:1,px:2,borderRadius:0,bgcolor:D?x(i.palette.primary.main,.08):"transparent","&:hover":{bgcolor:D?x(i.palette.primary.main,.12):x(i.palette.action.hover,.04)}},children:[e.jsx(ye,{sx:{minWidth:32,color:"text.secondary"},children:y.icon}),e.jsx(xe,{primary:y.label,secondary:y.sublabel,primaryTypographyProps:{fontSize:"0.875rem",fontWeight:500},secondaryTypographyProps:{fontSize:"0.75rem",color:"text.secondary"}})]},y.id)})}),e.jsxs(h,{sx:{px:2,pb:2},children:[e.jsx(Te,{dateAdapter:ke,children:e.jsx(ht,{value:l||d,onChange:$,showDaysOutsideCurrentMonth:!0,sx:{"& .MuiDateCalendar-root":{width:"100%"},"& .MuiPickersCalendarHeader-root":{justifyContent:"space-between",paddingLeft:0,paddingRight:0,"& .MuiIconButton-root":{color:"text.secondary","&:hover":{bgcolor:x(i.palette.primary.main,.08)}}},"& .MuiPickersDay-root":{fontSize:"0.875rem","&.Mui-selected":{bgcolor:i.palette.primary.main,color:i.palette.primary.contrastText,"&:hover":{bgcolor:i.palette.primary.dark}},"&.MuiPickersDay-today":{border:`2px solid ${i.palette.primary.main}`,bgcolor:"transparent",color:"text.primary"}}}})}),e.jsxs(h,{sx:{display:"flex",gap:1,mt:1},children:[e.jsxs(h,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:.5,py:.75,borderRadius:1,border:`1px solid ${i.palette.divider}`,color:"text.secondary",fontSize:"0.8125rem",cursor:"default"},children:[e.jsx(gt,{sx:{fontSize:"1rem"}}),"Time"]}),e.jsxs(h,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:.5,py:.75,borderRadius:1,border:`1px solid ${i.palette.divider}`,color:"text.secondary",fontSize:"0.8125rem",cursor:"default"},children:[e.jsx(bt,{sx:{fontSize:"1rem"}}),"Repeat"]})]})]})]})},Gt=[{value:"",label:"None"},{value:"low",label:we.low},{value:"medium",label:we.medium},{value:"high",label:we.high}],Vt=({initialTask:r,show:l,dueDate:t,priority:a,onDueDateChange:i,onPriorityChange:d})=>{const p=ie(),o=!!(t&&tt(t)),[b,A]=n.useState(null),$=u=>{u.preventDefault(),A(u.currentTarget)},y=()=>A(null),[w,D]=n.useState(null),M=u=>{u.preventDefault(),D(u.currentTarget)},R=()=>D(null),T=u=>{d(u),R()};return!l&&!t&&!a?null:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.75,flexWrap:"wrap",mt:.5},children:[o?e.jsx(je,{icon:e.jsx(Ne,{sx:{fontSize:"0.875rem !important",color:"#4caf50 !important"}}),label:"Today",size:"small",onClick:$,onDelete:u=>{u.stopPropagation(),i(null)},sx:{height:"28px",fontSize:"0.8125rem",backgroundColor:"#4caf50",color:"white",fontWeight:500,cursor:"pointer","& .MuiChip-icon":{color:"white !important"},"& .MuiChip-deleteIcon":{fontSize:"1rem",color:"white","&:hover":{color:"rgba(255,255,255,0.8)"}}}}):e.jsx(me,{type:"button",size:"small",startIcon:e.jsx(Ne,{sx:{fontSize:"0.875rem"}}),onClick:$,sx:{textTransform:"none",fontSize:"0.8125rem",color:p.palette.text.secondary,minWidth:"auto",px:1.25,py:.5,height:"28px",borderRadius:"6px",border:`1px solid ${x(p.palette.divider,.5)}`,backgroundColor:"transparent","&:hover":{backgroundColor:x(p.palette.action.hover,.5),borderColor:x(p.palette.divider,.8)}},children:"Today"}),e.jsx(rt,{anchorEl:b,value:t,onClose:y,onChange:u=>{i(u)}}),e.jsx(me,{type:"button",size:"small",startIcon:e.jsx(be,{sx:{fontSize:"0.875rem"}}),onClick:M,sx:{textTransform:"none",fontSize:"0.8125rem",color:a?ge(a):p.palette.text.secondary,minWidth:"auto",px:1.25,py:.5,height:"28px",borderRadius:"6px",border:`1px solid ${x(p.palette.divider,.5)}`,backgroundColor:a?x(ge(a),.12):"transparent","& .MuiButton-startIcon":{color:a?ge(a):p.palette.text.secondary},"&:hover":{backgroundColor:a?x(ge(a),.2):x(p.palette.action.hover,.5),borderColor:x(p.palette.divider,.8)}},children:a?we[a]:"Priority"}),e.jsx(Ee,{anchorEl:w,open:!!w,onClose:R,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{minWidth:140,mt:1}},children:Gt.map(({value:u,label:z})=>e.jsx(ce,{onClick:()=>T(u),selected:a===u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(ye,{sx:{minWidth:32},children:e.jsx(be,{sx:{fontSize:"1rem",color:ge(u)}})}),e.jsx(xe,{primary:z,primaryTypographyProps:{fontSize:"0.875rem"}}),a===u&&e.jsx(Fe,{sx:{fontSize:"1rem",color:"primary.main",ml:1}})]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{sx:{minWidth:32}}),e.jsx(xe,{primary:z,primaryTypographyProps:{fontSize:"0.875rem"}}),!a&&e.jsx(Fe,{sx:{fontSize:"1rem",color:"primary.main",ml:1}})]})},u||"none"))})]})},Yt=({show:r,isSubmitting:l,isSaveDisabled:t,onCancel:a})=>{const i=ie();return r?e.jsxs(h,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:1,mt:1.25,pt:1,borderTop:`1px solid ${x(i.palette.divider,.6)}`},children:[e.jsx(me,{type:"button",variant:"text",color:"inherit",size:"small",onClick:d=>{d.preventDefault(),d.stopPropagation(),a()},disabled:l,sx:{textTransform:"none",fontSize:"0.8125rem",fontWeight:600,height:"28px",borderRadius:"6px",px:1.5,minWidth:"68px",color:i.palette.text.secondary,"&:hover":{backgroundColor:x(i.palette.action.hover,.5)}},children:"Cancel"}),e.jsx(me,{type:"submit",variant:"contained",disableElevation:!0,size:"small",onClick:d=>d.stopPropagation(),disabled:l||t,sx:{textTransform:"none",fontSize:"0.8125rem",fontWeight:600,height:"28px",borderRadius:"6px",px:2,minWidth:"68px",backgroundColor:i.palette.primary.main,color:i.palette.primary.contrastText,"&:hover":{backgroundColor:i.palette.primary.dark},"&.Mui-disabled":{backgroundColor:x(i.palette.primary.main,.35),color:x(i.palette.primary.contrastText,.75)}},children:"Save"})]}):null},Se="data-tag-id",Ie="data-tag-pending-name",Me=["#4A9B6D","#5B7A9E","#B8954A","#A67B8A","#7B6B9E","#5A8A8A"],ot={backgroundColor:"rgba(255, 235, 59, 0.35)",borderRadius:"4px",padding:"0 2px"};function Xt(r,l){let t=0;const a=i=>{var d;if(i.nodeType===Node.TEXT_NODE){const p=((d=i.textContent)!=null?d:"").length;if(t+p>=l)return{node:i,offset:l-t};t+=p}else for(let p=0;p<i.childNodes.length;p++){const o=a(i.childNodes[p]);if(o)return o}return null};return a(r)}function Ae(r){var A;const l=window.getSelection();if(!l||l.rangeCount===0)return null;const t=l.getRangeAt(0);if(!r.contains(t.commonAncestorContainer))return null;const a=document.createRange();a.setStart(r,0),a.setEnd(t.endContainer,t.endOffset);const i=a.toString(),d=i.split(/\s/),p=(A=d[d.length-1])!=null?A:"",o=Math.max(0,i.length-p.length),b=Xt(r,o);return b?(a.setStart(b.node,b.offset),{word:p,range:a}):{word:p,range:a}}function ae(r){if(!r)return"";let l="";const t=a=>{var i;if(a.nodeType===Node.TEXT_NODE)l+=(i=a.textContent)!=null?i:"";else if(a.nodeType===Node.ELEMENT_NODE){const d=a;if(d.getAttribute(Se)||d.getAttribute(Ie))return;a.childNodes.forEach(t)}};return r.childNodes.forEach(t),l.trim()}function ze(r){if(!r)return[];const l=[];return r.querySelectorAll(`[${Se}]`).forEach(a=>{const i=a.getAttribute(Se);i&&!l.includes(i)&&l.push(i)}),l}function We(r){if(!r)return[];const l=[];return r.querySelectorAll(`[${Ie}]`).forEach(a=>{const i=a.getAttribute(Ie);i&&i.trim()&&!l.includes(i.trim())&&l.push(i.trim())}),l}function Qe(r){const l=document.createElement("span");return l.contentEditable="false",l.setAttribute(Se,r.id),l.textContent=`@${r.name}`,Object.assign(l.style,ot),l.setAttribute("data-tag-mention","1"),l}function Jt(r){const l=document.createElement("span");return l.contentEditable="false",l.setAttribute(Ie,r.trim()),l.textContent=`@${r.trim()}`,Object.assign(l.style,ot),l.setAttribute("data-tag-mention","1"),l}const nt=({value:r,onChange:l,onTagIdsChange:t,onPendingNamesChange:a,onTimeParsed:i,label:d,error:p,helperText:o,required:b,disabled:A,autoFocus:$,placeholder:y="Task name",inputRef:w,initialTagIds:D=[],onEscape:M,variant:R="default",sx:T})=>{const u=ie(),{tags:z}=ve(),V=n.useRef(null),g=w||V,Y=n.useRef(z);Y.current=z;const W=n.useRef(void 0),[B,q]=n.useState(!1),[S,X]=n.useState(!1),[I,H]=n.useState(""),[_,G]=n.useState(0),ee=I.trim().toLowerCase(),K=n.useMemo(()=>z.filter(m=>ee?m.name.toLowerCase().includes(ee):!0),[z,ee]),U=!I.trim(),s=K.length===0&&I?`Tag not found. Create ${I}`:I?`Create tag "${I}"`:"Create tag (type to name)",C=K.length+1,c=_===K.length,j=n.useCallback(()=>{const m=g.current;m&&(t==null||t(ze(m)),a==null||a(We(m)))},[g,t,a]),L=n.useCallback(m=>{const P=g.current;if(!P)return;const v=Ae(P);if(!v||!v.word.startsWith("@"))return;const{range:E}=v,F=window.getSelection();if(!F)return;E.deleteContents();const Z=Qe(m);E.insertNode(Z),E.setStartAfter(Z),E.collapse(!0),F.removeAllRanges(),F.addRange(E);const oe=ae(P);W.current=oe,l(oe),X(!1),H(""),G(0),j()},[l,j]),f=n.useCallback(m=>{if(!m.trim())return;const P=g.current;if(!P)return;const v=Ae(P);if(!v||!v.word.startsWith("@"))return;const{range:E}=v,F=window.getSelection();if(!F)return;E.deleteContents();const Z=Jt(m);E.insertNode(Z),E.setStartAfter(Z),E.collapse(!0),F.removeAllRanges(),F.addRange(E);const oe=ae(P);W.current=oe,l(oe),X(!1),H(""),G(0),j()},[l,j]),N=n.useCallback(m=>{const P=m.currentTarget,v=ae(P);W.current=v,l(v),j();const E=Ae(P);E!=null&&E.word.startsWith("@")?(H(E.word.slice(1)),X(!0),G(0)):X(!1)},[l,j]),J=n.useRef(void 0),k=n.useRef(i);k.current=i,n.useEffect(()=>{var P;if(!r.trim()){J.current!==null&&(J.current=null,(P=k.current)==null||P.call(k,null));return}let m=!1;return Kt(()=>de(void 0,null,function*(){const{parseTimeFromText:v}=yield import("./taskHelpers-DNe9C59J.js");return{parseTimeFromText:v}}),[]).then(({parseTimeFromText:v})=>{var fe;if(m)return;const{time:E}=v(r),F=E!=null?E:null,Z=J.current;Z===F||Z!=null&&F!=null&&Z.getTime()===F.getTime()||(J.current=F,(fe=k.current)==null||fe.call(k,F))}),()=>{m=!0}},[r]),n.useEffect(()=>{const m=g.current;if(!m)return;const P=W.current;if(r===P)return;const v=ae(m);if(P!==void 0&&P===v)return;const E=ze(m),F=E.length===D.length&&D.every(oe=>E.includes(oe));if(v===r&&F)return;m.textContent="",r&&m.appendChild(document.createTextNode(r));const Z=Y.current;D.forEach(oe=>{const fe=Z.find(at=>at.id===oe);fe&&(m.childNodes.length>0&&m.appendChild(document.createTextNode("Â ")),m.appendChild(Qe(fe)))}),W.current=r,j()},[r,D]);const Q=n.useCallback(m=>{var P;if(m.key==="Escape"){if(S){m.preventDefault(),X(!1);return}M==null||M();return}if(S){if(m.key==="ArrowDown"){m.preventDefault(),G(v=>v<C-1?v+1:0);return}if(m.key==="ArrowUp"){m.preventDefault(),G(v=>v>0?v-1:C-1);return}if((m.key==="Enter"||m.key==="Tab")&&C>0){m.preventDefault(),c?U||f(I.trim()):L(K[_]);return}}if(m.key==="Enter"&&!m.shiftKey){m.preventDefault();const v=(P=g.current)==null?void 0:P.closest("form");v&&v.requestSubmit()}},[S,C,c,U,I,K,_,L,f,g,M]),te=n.useCallback(m=>{m.preventDefault();const P=m.clipboardData.getData("text/plain"),v=window.getSelection();if(v!=null&&v.rangeCount&&g.current){const F=v.getRangeAt(0);F.deleteContents();const Z=document.createTextNode(P);F.insertNode(Z),F.setStartAfter(Z),F.setEndAfter(Z),v.removeAllRanges(),v.addRange(F)}const E=g.current?ae(g.current):"";W.current=E,l(E),j()},[l,j]);n.useEffect(()=>{$&&g.current&&requestAnimationFrame(()=>{var m;return(m=g.current)==null?void 0:m.focus()})},[$]);const re=r||(g.current?ae(g.current):"")||"",O=R==="inline";return e.jsxs(h,{sx:ne({flex:1,display:"flex",flexDirection:"column",position:"relative"},T),children:[e.jsxs(h,{sx:{position:"relative",display:"flex",flexDirection:"column"},children:[d&&!O&&e.jsxs(Ye,{shrink:B||!!re,sx:{position:"absolute",left:0,top:0,transform:B||re?"translate(14px, -9px) scale(0.75)":"translate(14px, 14px) scale(1)",transformOrigin:"top left",color:p?u.palette.error.main:B?u.palette.primary.main:u.palette.text.secondary,pointerEvents:"none",transition:"all 0.2s cubic-bezier(0.0, 0, 0.2, 1) 0ms",zIndex:1,backgroundColor:u.palette.background.paper,padding:B||re?"0 4px":"0"},children:[d,b&&" *"]}),e.jsx(h,{ref:g,contentEditable:!A,suppressContentEditableWarning:!0,onInput:N,onKeyDown:Q,onPaste:te,onFocus:()=>q(!0),onBlur:()=>q(!1),"data-placeholder":y,sx:he(ne({minHeight:O?"28px":"40px",maxHeight:O?"200px":void 0,overflowY:O?"auto":void 0,padding:O?0:d?B||re?"14px 14px 2px 14px":"20px 14px 2px 14px":"8.5px 14px",border:O?"none":`1px solid ${p?u.palette.error.main:B?u.palette.primary.main:u.palette.mode==="dark"?x(u.palette.common.white,.2):x(u.palette.common.black,.2)}`,borderRadius:O?0:"4px",backgroundColor:O?"transparent":u.palette.mode==="dark"?x(u.palette.common.white,.05):x(u.palette.common.black,.02),color:u.palette.text.primary,fontSize:O?"0.9375rem":"0.875rem",fontWeight:O?500:400,fontFamily:u.typography.fontFamily,outline:"none",cursor:A?"not-allowed":"text",opacity:A?.6:1,transition:O?void 0:"border-color 0.2s ease",wordBreak:"break-word"},!O&&{"&:hover":{borderColor:p?u.palette.error.main:u.palette.mode==="dark"?x(u.palette.common.white,.3):x(u.palette.common.black,.3)},"&:focus":{borderColor:u.palette.primary.main,borderWidth:"2px",padding:d?B||re?"13px 13px 1px 13px":"19px 13px 1px 13px":"7.5px 13px"}}),{"&:empty:before":ne({content:"attr(data-placeholder)",color:u.palette.text.secondary,opacity:.6},O&&{fontWeight:400})})}),e.jsx(yt,{open:S,anchorEl:g.current,placement:"bottom-start",style:{zIndex:u.zIndex.tooltip},children:e.jsx(jt,{elevation:2,sx:{maxHeight:240,overflow:"auto",minWidth:180},children:e.jsxs(Ge,{dense:!0,disablePadding:!0,children:[K.map((m,P)=>e.jsxs(_e,{selected:P===_,onMouseDown:v=>{v.preventDefault(),L(m)},sx:{py:.5},children:[e.jsx(vt,{sx:{fontSize:18,mr:1,color:"text.secondary"}}),m.name]},m.id)),e.jsxs(_e,{selected:c,disabled:U,onMouseDown:m=>{m.preventDefault(),U||f(I.trim())},sx:{py:.5},children:[e.jsx(Dt,{sx:{fontSize:18,mr:1,color:"text.secondary"}}),s]})]})})})]}),o&&e.jsx(Ct,{error:p,sx:{mt:.5,mx:1.75},children:o})]})},Zt=Qt.component("InlineTaskEditor"),Ut=({onSubmit:r,onCancel:l,initialTask:t,autoFocus:a=!0,categories:i,defaultCategoryId:d,defaultDueDate:p=null,defaultTagIds:o=[]})=>{var j,L;const b=ie(),{categories:A,tags:$,addTag:y}=ve(),[w,D]=n.useState(""),[M,R]=n.useState(""),[T,u]=n.useState(null),[z,V]=n.useState(""),[g,Y]=n.useState(d),[W,B]=n.useState(o),[q,S]=n.useState(!1),[X,I]=n.useState(!1),H=n.useRef(null),_=n.useRef(null),G=n.useRef(null),ee=n.useRef(null),K=n.useRef(!1);n.useEffect(()=>{var J,k;const f=(J=t==null?void 0:t.id)!=null?J:null,N=ee.current===f;t?(K.current=!1,N||(ee.current=t.id,D(t.title),R(t.description||""),u(t.dueDate?new Date(t.dueDate):null),V(t.priority||""),Y(t.categoryId||d),B((k=t.tags)!=null?k:[]),I(!0),_.current&&(_.current.textContent=t.description||""))):(ee.current=null,K.current||(K.current=!0,u(p),B(o)),I(!0),_.current&&(_.current.textContent=""))},[t,d,p,o]),n.useEffect(()=>{const f=N=>{var Q,te;const J=N.target;if(!G.current||G.current.contains(J))return;const k=N.target;(Q=k.closest)!=null&&Q.call(k,"[data-add-task-trigger]")||(te=k.closest)!=null&&te.call(k,'[role="dialog"]')||!q&&w.trim()===""&&M.trim()===""&&l()};return document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[l,q,w,M]);const U=n.useMemo(()=>{var f,N,J,k;if(t){const Q=(t.description||"")===M,te=t.dueDate==null&&T==null||t.dueDate!=null&&T!=null&&new Date(t.dueDate).getTime()===T.getTime(),re=((N=(f=t.tags)==null?void 0:f.length)!=null?N:0)===W.length&&((J=t.tags)!=null?J:[]).every(O=>W.includes(O));return w!==t.title||!Q||!te||(t.priority||"")!==z||(t.categoryId||d)!==g||!re}return w.trim()!==""||M.trim()!==""||z!==""||g!==d||W.length!==((k=o==null?void 0:o.length)!=null?k:0)||(o==null?void 0:o.some(Q=>!W.includes(Q)))},[t,w,M,T,z,g,d,W,o]);n.useEffect(()=>{const f=N=>{U&&(N.preventDefault(),N.returnValue="")};return window.addEventListener("beforeunload",f),()=>window.removeEventListener("beforeunload",f)},[U]);const s=n.useCallback(f=>{const N=f.currentTarget.textContent||"";R(N),I(N.length>0||w.length>0)},[w]),C=n.useCallback(()=>de(void 0,null,function*(){const N=ae(H.current).trim();if(!N||q)return;const J=ze(H.current),k=We(H.current);try{S(!0);const Q=[];for(let O=0;O<k.length;O++){const m=k[O],P=Me[($.length+O)%Me.length],v=yield y({name:m,color:P});Q.push(v.id)}const te=[...J,...Q],re={title:N,description:M.trim()||void 0,dueDate:T||void 0,priority:z||void 0,categoryId:g,tags:te.length>0?te:void 0,status:"todo",createdAt:(t==null?void 0:t.createdAt)||new Date,updatedAt:new Date};yield r(re),t||(D(""),R(""),u(null),V(""),Y(d),B(o),I(!1),_.current&&(_.current.textContent=""),requestAnimationFrame(()=>{var O;return(O=H.current)==null?void 0:O.focus()}))}catch(Q){Zt.error("Failed to submit task",{error:Q})}finally{S(!1)}}),[M,T,z,g,r,t,q,d,o,$.length,y]),c=n.useCallback(f=>{f.key==="Enter"&&!f.shiftKey?(f.preventDefault(),f.stopPropagation(),C()):f.key==="Escape"&&(f.preventDefault(),f.stopPropagation(),l())},[C,l]);return e.jsx(h,{component:wt.div,initial:{opacity:0,y:-6},animate:{opacity:1,y:0},transition:{duration:.2,ease:"easeOut"},sx:{mb:2},children:e.jsx(h,{ref:G,component:"form",onSubmit:f=>{f.preventDefault(),f.stopPropagation(),C()},sx:{display:"block",bgcolor:"transparent",borderRadius:0,border:"none",boxShadow:"none",overflow:"hidden"},children:e.jsxs(h,{sx:{display:"flex",alignItems:"flex-start",p:1.5,gap:1.5},children:[!t&&e.jsx(h,{sx:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",mt:.5},children:e.jsx(h,{sx:{width:16,height:16,border:`2px solid ${x(b.palette.text.secondary,.4)}`,borderRadius:"50%",transition:"all 0.2s ease"}})}),e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(nt,{inputRef:H,value:w,onChange:f=>{D(f),I(f.length>0||M.length>0)},onTagIdsChange:B,onTimeParsed:f=>{f&&!t?u(f):!f&&!t&&!w.trim()&&u(null)},placeholder:"Task name",variant:"inline",autoFocus:a,initialTagIds:t?(j=t.tags)!=null?j:[]:o,onEscape:l},(L=t==null?void 0:t.id)!=null?L:"new"),e.jsx(h,{ref:_,contentEditable:!0,suppressContentEditableWarning:!0,onInput:s,onKeyDown:c,"data-placeholder":"Description",sx:{minHeight:"24px",maxHeight:"150px",overflowY:"auto",outline:"none",fontSize:"0.875rem",lineHeight:1.5,color:b.palette.text.secondary,wordBreak:"break-word","&:empty:before":{content:"attr(data-placeholder)",color:b.palette.text.secondary,opacity:.5,fontStyle:"italic"},"&:focus":{outline:"none",color:b.palette.text.primary}}}),e.jsx(Vt,{initialTask:!!t,show:X,dueDate:T,priority:z,onDueDateChange:f=>u(f),onPriorityChange:f=>V(f)}),e.jsx(Yt,{show:!!t,isSubmitting:q,isSaveDisabled:w.trim()==="",onCancel:l})]})]})})})},er=({anchorEl:r,tempDate:l,hasExistingDueDate:t,onClose:a,onDateChange:i,onRemove:d})=>{const p=ie();return e.jsx(qe,{open:!!r,anchorEl:r,onClose:a,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{mt:1,p:2,minWidth:{xs:"calc(100vw - 32px)",sm:280},backgroundColor:p.palette.background.paper,boxShadow:p.palette.mode==="dark"?"0 8px 24px rgba(0, 0, 0, 0.4)":"0 8px 24px rgba(0, 0, 0, 0.15)"}},children:e.jsx(Te,{dateAdapter:ke,children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(Xe,{label:"Date",value:l,onChange:i,slotProps:{textField:{size:"small",fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{backgroundColor:p.palette.mode==="dark"?x(p.palette.common.white,.05):x(p.palette.common.black,.02)}}}}}),t&&e.jsx(h,{sx:{display:"flex",justifyContent:"flex-end",pt:1},children:e.jsx(se,{onClick:d,sx:{cursor:"pointer",color:"error.main",fontSize:"0.875rem","&:hover":{textDecoration:"underline"}},children:"Remove date"})})]})})})},tr=({task:r,onToggleComplete:l,onDelete:t,onEdit:a,onUpdate:i,isActionInProgress:d=!1,showPriorityRing:p=!1})=>{const o=ie(),b=Oe(o.breakpoints.down("sm")),{tags:A,categories:$}=ve(),{activeInlineTaskId:y,setActiveInlineTaskId:w}=qt(),[D,M]=n.useState(null),[R,T]=n.useState(null),[u,z]=n.useState(!1),V=n.useRef(null),g=u&&y===r.id;n.useEffect(()=>{y!==r.id&&u&&z(!1)},[y,r.id,u]);const Y=n.useMemo(()=>{var C;const s=(C=r.categoryId)!=null?C:r.category;return s?$.find(c=>c.id===s):void 0},[r.categoryId,r.category,$]),W=n.useMemo(()=>{var s;return((s=r.tags)==null?void 0:s.map(C=>A.find(c=>c.id===C)).filter(Boolean))||[]},[r.tags,A]),B=n.useMemo(()=>{if(!r.dueDate||r.completed)return!1;const s=le(new Date(r.dueDate)),C=le(new Date);return $t(s,C)},[r.dueDate,r.completed]),q=n.useMemo(()=>{if(!r.dueDate)return"";const s=new Date(r.dueDate);return ue(s,"MMM d yyyy")},[r.dueDate]),S=n.useMemo(()=>{if(!(!p||r.completed))switch(r.priority){case"high":return o.palette.error.main;case"medium":return o.palette.warning.main;case"low":return o.palette.info.main;default:return}},[p,r.completed,r.priority,o.palette.error.main,o.palette.warning.main,o.palette.info.main]),X=n.useCallback(s=>{s==null||s.stopPropagation(),l(r.id)},[l,r.id]),I=n.useCallback(s=>{s==null||s.stopPropagation(),t(r.id)},[t,r.id]),H=n.useCallback(()=>{g||a(r)},[a,r,g]),_=n.useCallback(s=>{if(s==null||s.stopPropagation(),!i){H();return}w(r.id),z(!0)},[i,H,w,r.id]),G=n.useCallback(s=>{if(i)if(s.stopPropagation(),M(s.currentTarget),r.dueDate){const C=new Date(r.dueDate);T(C)}else T(new Date)},[i,r.dueDate]),ee=n.useCallback(()=>{M(null)},[]),K=n.useCallback(s=>{if(s&&(T(s),i)){const C=le(new Date(s));i(r.id,{dueDate:C}),M(null)}},[i,r.id]),U=n.useCallback(()=>de(void 0,null,function*(){i&&(yield i(r.id,{dueDate:void 0}),M(null))}),[i,r.id]);return e.jsxs(Ve,{onClick:g?void 0:H,onKeyDown:s=>{g||(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),H())},role:g?void 0:"button",tabIndex:g?-1:0,"aria-label":`Open task: ${r.title}`,sx:{mb:2,bgcolor:"transparent",transition:"opacity 0.2s ease",cursor:g?"default":"pointer",borderRadius:1,"&:hover":{backgroundColor:"transparent !important"},"& .MuiListItemSecondaryAction-root":{opacity:b?1:0,transition:"opacity 0.2s ease"},"&:hover .MuiListItemSecondaryAction-root":{opacity:1},"&:focus-visible":{outline:`2px solid ${x(o.palette.primary.main,.5)}`,outlineOffset:2}},children:[!g&&e.jsx(pe,{edge:"start",onClick:s=>X(s),disabled:d,size:"small",sx:{p:.25,mr:.5,backgroundColor:"transparent","&:hover":{backgroundColor:"transparent"},"&:hover .check-hover":{opacity:1}},"aria-label":r.completed?"Mark incomplete":"Mark complete",children:r.completed?e.jsx(He,{sx:{fontSize:17,color:"success.main"}}):e.jsxs(h,{component:"span",sx:{position:"relative",display:"inline-flex",width:17,height:17},children:[e.jsx(It,{sx:{fontSize:17,color:S!=null?S:"action.active"}}),e.jsx(He,{className:"check-hover",sx:{position:"absolute",left:0,top:0,fontSize:16,color:"white",opacity:0,transition:"opacity 0.15s ease",pointerEvents:"none",backgroundColor:"transparent"}})]})}),g&&i?e.jsx(h,{sx:{flex:1},onClick:s=>s.stopPropagation(),children:e.jsx(Ut,{initialTask:r,onSubmit:s=>de(void 0,null,function*(){yield i(r.id,s),w(null),z(!1)}),onCancel:()=>{w(null),z(!1)},defaultCategoryId:r.categoryId,autoFocus:!0})}):e.jsx(xe,{primary:e.jsx(se,{variant:"body1",sx:{fontSize:"0.875rem",textDecoration:r.completed?"line-through":"none",color:r.completed?"text.secondary":"text.primary"},children:r.title}),secondary:e.jsxs(h,{children:[r.description&&e.jsx(se,{variant:"body2",sx:{color:"text.secondary",fontSize:"0.8125rem",mb:r.dueDate||Y||W.length>0?.5:0,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:r.description}),e.jsxs(h,{sx:{display:"flex",gap:1,mt:.5,flexWrap:"wrap"},children:[r.dueDate&&e.jsxs(h,{ref:V,onClick:G,sx:{display:"flex",alignItems:"center",gap:.5,cursor:i?"pointer":"default",borderRadius:1,px:.5,py:.25,"&:hover":i?{backgroundColor:x(o.palette.primary.main,.1)}:{},transition:"background-color 0.2s ease"},children:[e.jsx(Je,{fontSize:"small",sx:{fontSize:"0.8125rem"}}),e.jsx(se,{variant:"body2",sx:{color:B?"error.main":"text.secondary",fontSize:"0.8125rem"},children:q})]}),Y&&e.jsx(De,{title:"Category",children:e.jsx(je,{size:"small",icon:e.jsx(Ze,{fontSize:"small"}),label:Y.name,onClick:s=>s.stopPropagation(),sx:{bgcolor:"background.default","& .MuiChip-label":{px:1}}})}),W.map(s=>e.jsx(De,{title:s.name,children:e.jsx(je,{size:"small",label:s.name,onClick:C=>C.stopPropagation(),sx:{bgcolor:s.color||"background.default",color:"white","& .MuiChip-label":{px:1}}})},s.id))]})]})}),!g&&e.jsxs(Mt,{children:[e.jsx(De,{title:"Edit",children:e.jsx("span",{children:e.jsx(pe,{edge:"end",onClick:s=>_(s),disabled:d,sx:{mr:.5},size:"small","aria-label":"Edit task",children:e.jsx(zt,{sx:{fontSize:"1rem"}})})})}),e.jsx(De,{title:"Delete",children:e.jsx("span",{children:e.jsx(pe,{edge:"end",onClick:s=>I(s),disabled:d,size:"small","aria-label":"Delete task",children:e.jsx(At,{sx:{fontSize:"1rem"}})})})})]}),i&&e.jsx(er,{anchorEl:D,tempDate:R,hasExistingDueDate:!!r.dueDate,onClose:ee,onDateChange:K,onRemove:U})]})},sr=St.memo(tr),lr=({open:r,onClose:l,onSubmit:t,initialTask:a,loading:i=!1,defaultDueDate:d=null,defaultTagIds:p=[]})=>{var U;const o=ie(),b=Oe(o.breakpoints.down("sm")),{tags:A,addTag:$}=ve(),[y,w]=n.useState(""),[D,M]=n.useState(""),[R,T]=n.useState(null),[u,z]=n.useState(""),[V,g]=n.useState(p),[Y,W]=n.useState([]),[B,q]=n.useState({}),[S,X]=n.useState(!1),I=n.useRef(null);n.useEffect(()=>{var s;a?(w(a.title),M(a.description||""),T(a.dueDate?new Date(a.dueDate):null),z(a.priority||""),g((s=a.tags)!=null?s:[]),W([])):(_(),T(d),g(p),W([]))},[a,r]),n.useEffect(()=>{r&&I.current&&requestAnimationFrame(()=>{setTimeout(()=>{var s;(s=I.current)==null||s.focus()},0)})},[r]);const H=n.useMemo(()=>{var s,C,c;if(!r)return!1;if(a){const j=(a.description||"")===D,L=a.dueDate==null&&R==null||a.dueDate!=null&&R!=null&&new Date(a.dueDate).getTime()===R.getTime();return y!==a.title||!j||!L||(a.priority||"")!==u||((C=(s=a.tags)==null?void 0:s.length)!=null?C:0)!==V.length||((c=a.tags)!=null?c:[]).some(f=>!V.includes(f))}return y.trim()!==""||D.trim()!==""||u!==""||V.length>0||Y.length>0},[r,a,y,D,R,u,V,Y]);n.useEffect(()=>{const s=C=>{H&&(C.preventDefault(),C.returnValue="")};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[H]);const _=()=>{w(""),M(""),T(null),z(""),g(p),W([]),q({}),X(!1)},G=()=>{const s={};return y.trim()||(s.title="Task name is required"),q(s),Object.keys(s).length===0},ee=s=>de(void 0,null,function*(){var c;s.preventDefault();const C=ae(I.current)||y;if(w(C),yield new Promise(j=>setTimeout(j,0)),!(!G()||S))try{X(!0);const j=ze(I.current),L=We(I.current),f=[];for(let Q=0;Q<L.length;Q++){const te=L[Q],re=Me[(A.length+Q)%Me.length],O=yield $({name:te,color:re});f.push(O.id)}const N=[...j,...f],k={title:((c=ae(I.current))==null?void 0:c.trim())||y.trim(),description:D||void 0,dueDate:R||void 0,priority:u||void 0,tags:N.length>0?N:void 0,status:"todo",createdAt:(a==null?void 0:a.createdAt)||new Date,updatedAt:new Date};yield t(k),_(),l()}catch(j){q({submit:"Failed to save task. Please try again."})}finally{X(!1)}}),K=()=>{S||(_(),l())};return e.jsx(Ue,{open:r,onClose:K,fullScreen:b,PaperProps:{sx:he(ne({width:b?"100%":"550px",minHeight:b?"100%":"220px",maxWidth:b?"100%":"550px",maxHeight:b?"100%":"90vh"},!b&&{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}),{m:0,backgroundColor:o.palette.background.paper,color:o.palette.text.primary,boxShadow:b?"none":o.palette.mode==="dark"?"0 20px 60px -12px rgba(0, 0, 0, 0.5), 0 8px 24px -4px rgba(0, 0, 0, 0.4)":"0 20px 60px -12px rgba(0, 0, 0, 0.15), 0 8px 24px -4px rgba(0, 0, 0, 0.1)",borderRadius:b?0:"12px"})},TransitionProps:{onEntered:()=>{var s;(s=I.current)==null||s.focus()}},disableEscapeKeyDown:S,children:e.jsx(et,{sx:{p:2,height:"100%",backgroundColor:o.palette.background.paper,color:o.palette.text.primary,"&.MuiDialogContent-root":{paddingTop:2}},children:e.jsx("form",{onSubmit:ee,style:{height:"100%",display:"flex",flexDirection:"column"},children:e.jsxs(Pt,{spacing:1.5,sx:{flexGrow:1},children:[B.submit&&e.jsx(Et,{severity:"error",sx:{py:.5,backgroundColor:x(o.palette.error.main,.15),color:o.palette.text.primary,"& .MuiAlert-icon":{color:o.palette.error.main}},children:B.submit}),e.jsxs(h,{sx:{display:"flex",flexDirection:b?"column":"row",gap:1.5},children:[e.jsx(nt,{inputRef:I,value:y,onChange:w,onTagIdsChange:g,onPendingNamesChange:W,onTimeParsed:s=>{T(s||null)},label:"Task name",error:!!B.title,helperText:B.title,required:!0,disabled:S,autoFocus:!0,initialTagIds:V,sx:{flex:1}},(U=a==null?void 0:a.id)!=null?U:"new"),e.jsxs(h,{sx:{display:"flex",gap:1.5},children:[e.jsx(Te,{dateAdapter:ke,children:e.jsx(Xe,{label:"Date",value:R,onChange:s=>T(s),slotProps:{textField:{size:"small",sx:{width:b?"100%":"140px","& .MuiOutlinedInput-root":{backgroundColor:o.palette.mode==="dark"?x(o.palette.common.white,.05):x(o.palette.common.black,.02),"& fieldset":{borderColor:o.palette.mode==="dark"?x(o.palette.common.white,.2):x(o.palette.common.black,.2)},"&:hover fieldset":{borderColor:o.palette.mode==="dark"?x(o.palette.common.white,.3):x(o.palette.common.black,.3)},"&.Mui-focused fieldset":{borderColor:o.palette.primary.main}},"& .MuiInputLabel-root":{color:o.palette.text.secondary},"& .MuiInputLabel-root.Mui-focused":{color:o.palette.primary.main},"& .MuiInputBase-input":{color:o.palette.text.primary}}}},disabled:S})}),e.jsxs(Rt,{size:"small",sx:{width:b?"100%":"120px"},children:[e.jsx(Ye,{sx:{color:o.palette.text.secondary},children:"Priority"}),e.jsxs(Tt,{value:u,onChange:s=>z(s.target.value),label:"Priority",disabled:S,sx:{color:o.palette.text.primary,"& .MuiOutlinedInput-notchedOutline":{borderColor:o.palette.mode==="dark"?x(o.palette.common.white,.2):x(o.palette.common.black,.2)},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:o.palette.mode==="dark"?x(o.palette.common.white,.3):x(o.palette.common.black,.3)},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:o.palette.primary.main},"& .MuiSvgIcon-root":{color:o.palette.text.secondary}},MenuProps:{PaperProps:{sx:{backgroundColor:o.palette.background.paper,"& .MuiMenuItem-root":{color:o.palette.text.primary,"&:hover":{backgroundColor:o.palette.action.hover},"&.Mui-selected":{backgroundColor:x(o.palette.primary.main,.2),"&:hover":{backgroundColor:x(o.palette.primary.main,.3)}}}}}},children:[e.jsx(ce,{value:"",children:"None"}),e.jsx(ce,{value:"low",children:"Low"}),e.jsx(ce,{value:"medium",children:"Medium"}),e.jsx(ce,{value:"high",children:"High"})]})]})]})]}),e.jsx(Re,{label:"Description",value:D,onChange:s=>M(s.target.value),multiline:!0,rows:1,size:"small",fullWidth:!0,disabled:S,sx:{"& .MuiOutlinedInput-root":{backgroundColor:o.palette.mode==="dark"?x(o.palette.common.white,.05):x(o.palette.common.black,.02),"& fieldset":{borderColor:o.palette.mode==="dark"?x(o.palette.common.white,.2):x(o.palette.common.black,.2)},"&:hover fieldset":{borderColor:o.palette.mode==="dark"?x(o.palette.common.white,.3):x(o.palette.common.black,.3)},"&.Mui-focused fieldset":{borderColor:o.palette.primary.main}},"& .MuiInputLabel-root":{color:o.palette.text.secondary},"& .MuiInputLabel-root.Mui-focused":{color:o.palette.primary.main},"& .MuiInputBase-input":{color:o.palette.text.primary}}}),e.jsxs(h,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mt:"auto"},children:[e.jsx(me,{onClick:K,disabled:S,size:"small",sx:{color:o.palette.text.secondary,"&:hover":{backgroundColor:o.palette.action.hover}},children:"Cancel"}),e.jsx(me,{type:"submit",variant:"contained",color:"primary",disabled:S||i,size:"small",sx:{backgroundColor:o.palette.primary.main,color:o.palette.primary.contrastText,"&:hover":{backgroundColor:o.palette.primary.dark},"&:disabled":{backgroundColor:x(o.palette.primary.main,.3),color:x(o.palette.primary.contrastText,.5)}},children:S?e.jsx(kt,{size:20,color:"inherit"}):"Add Task"})]})]})})})})},Pe=[{value:"high",label:"P1",color:"#e53935"},{value:"medium",label:"P2",color:"#fb8c00"},{value:"low",label:"P3",color:"#1e88e5"},{value:"",label:"P4",color:"#ffffff"}],ir=({open:r,onClose:l,task:t,onUpdate:a,onToggleComplete:i})=>{var s,C;const d=ie(),p=Oe(d.breakpoints.down("sm")),{tags:o,categories:b}=ve(),[A,$]=n.useState(t.title),[y,w]=n.useState(t.description||""),[D,M]=n.useState(t.dueDate?new Date(t.dueDate):null),[R,T]=n.useState(t.priority||""),[u,z]=n.useState(!1),[V,g]=n.useState(null),[Y,W]=n.useState(null),[B,q]=n.useState(null),S=n.useMemo(()=>{var j;const c=(j=t.categoryId)!=null?j:t.category;return c?b.find(L=>L.id===c):void 0},[t.categoryId,t.category,b]),X=n.useMemo(()=>{var c;return((c=t.tags)!=null?c:[]).map(j=>o.find(L=>L.id===j)).filter(Boolean)},[t.tags,o]),I=n.useMemo(()=>o.filter(c=>{var j;return!((j=t.tags)!=null?j:[]).includes(c.id)}),[o,t.tags]),H=n.useCallback(c=>{var L;const j=(L=t.tags)!=null?L:[];j.includes(c)||(a(t.id,{tags:[...j,c],updatedAt:new Date}),g(null))},[t.id,t.tags,a]),_=n.useCallback(c=>{var L;const j=((L=t.tags)!=null?L:[]).filter(f=>f!==c);a(t.id,{tags:j,updatedAt:new Date})},[t.id,t.tags,a]);n.useEffect(()=>{r&&t&&($(t.title),w(t.description||""),M(t.dueDate?new Date(t.dueDate):null),T(t.priority||""))},[r,t]);const G=n.useMemo(()=>{var c;return(c=Pe.find(j=>j.value===R))!=null?c:Pe[3]},[R]),ee=n.useCallback(()=>{i(t.id)},[t.id,i]),K=n.useCallback(()=>de(void 0,null,function*(){var j;const c={};if(A!==t.title&&(c.title=A),y!==(t.description||"")&&(c.description=y||void 0),((j=D==null?void 0:D.getTime())!=null?j:null)!==(t.dueDate?new Date(t.dueDate).getTime():null)&&(c.dueDate=D||void 0),(R||"")!==(t.priority||"")&&(c.priority=R||void 0),Object.keys(c).length!==0)try{z(!0),yield a(t.id,he(ne({},c),{updatedAt:new Date}))}finally{z(!1)}}),[A,y,D,R,t,a]),U=n.useCallback(c=>{T(c),a(t.id,{priority:c||void 0,updatedAt:new Date}),W(null)},[t.id,a]);return e.jsx(Ue,{open:r,onClose:l,maxWidth:!1,fullScreen:p,PaperProps:{sx:{width:p?"100%":"90vw",maxWidth:p?"100%":720,minHeight:p?"100%":400,maxHeight:p?"100%":"85vh",borderRadius:p?0:2,backgroundColor:d.palette.background.paper,boxShadow:d.palette.mode==="dark"?"0 24px 48px rgba(0, 0, 0, 0.4)":"0 24px 48px rgba(0, 0, 0, 0.12)"}},children:e.jsxs(et,{sx:{p:0,display:"flex",flexDirection:"column",minHeight:400},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:1.5,borderBottom:1,borderColor:"divider"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ot,{sx:{fontSize:"1.25rem",color:"text.secondary"}}),e.jsx(se,{variant:"subtitle1",sx:{fontWeight:600,fontSize:"0.9375rem"},children:(s=S==null?void 0:S.name)!=null?s:"Inbox"})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.25},children:[e.jsx(pe,{size:"small",sx:{color:"text.secondary"},children:e.jsx(Wt,{fontSize:"small"})}),e.jsx(pe,{size:"small",sx:{color:"text.secondary"},children:e.jsx(Bt,{fontSize:"small"})}),e.jsx(pe,{size:"small",sx:{color:"text.secondary"},children:e.jsx(Lt,{fontSize:"small"})}),e.jsx(pe,{size:"small",onClick:l,sx:{color:"text.secondary"},children:e.jsx(Nt,{fontSize:"small"})})]})]}),e.jsxs(h,{sx:{display:"flex",flexDirection:p?"column":"row",flex:1,overflow:p?"auto":"hidden"},children:[e.jsxs(h,{sx:ne({flex:2,display:"flex",flexDirection:"column",minWidth:0},!p&&{borderRight:1,borderColor:"divider"}),children:[e.jsxs(h,{sx:{display:"flex",alignItems:"flex-start",gap:1,px:2,py:2},children:[e.jsx(Ft,{checked:t.completed,onChange:ee,sx:{p:.25,mt:.25}}),e.jsx(Re,{value:A,onChange:c=>$(c.target.value),onBlur:K,variant:"standard",fullWidth:!0,multiline:!0,maxRows:4,InputProps:{disableUnderline:!0,sx:{fontSize:"1.125rem",fontWeight:600,textDecoration:t.completed?"line-through":"none",color:t.completed?"text.secondary":"text.primary"}}})]}),e.jsxs(h,{sx:{px:2,pb:2},children:[e.jsx(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:e.jsx("span",{style:{fontSize:"0.875rem",color:d.palette.text.secondary},children:"Description"})}),e.jsx(Re,{value:y,onChange:c=>w(c.target.value),onBlur:K,placeholder:"Add a more detailed description...",multiline:!0,minRows:2,maxRows:8,fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{backgroundColor:x(d.palette.text.primary,.04),fontSize:"0.875rem","& fieldset":{borderColor:"transparent"},"&:hover fieldset":{borderColor:"divider"},"&.Mui-focused fieldset":{borderColor:"primary.main"}}}})]})]}),e.jsxs(h,{sx:he(ne(ne({flex:p?"none":1},p?{}:{minWidth:200,maxWidth:260}),p&&{borderTop:1,borderColor:"divider"}),{p:2,display:"flex",flexDirection:"column",gap:1.5}),children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_t,{sx:{fontSize:"1.125rem",color:"text.secondary"}}),e.jsx(se,{variant:"body2",sx:{color:"text.secondary"},children:(C=S==null?void 0:S.name)!=null?C:"Inbox"})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(be,{sx:{fontSize:"1.125rem",color:"text.secondary",flexShrink:0}}),e.jsxs(h,{component:"button",onClick:c=>W(c.currentTarget),sx:{flex:1,display:"flex",alignItems:"center",gap:.75,py:.75,px:1,border:"1px solid transparent",borderRadius:1,backgroundColor:"transparent",cursor:"pointer",fontSize:"0.875rem",color:"text.primary",fontFamily:"inherit",textAlign:"left",transition:"background-color 0.15s, border-color 0.15s","&:hover":{backgroundColor:x(d.palette.text.primary,.04),borderColor:"divider"}},children:[e.jsx(be,{sx:{fontSize:"1rem",color:G.color==="#ffffff"?d.palette.divider:G.color}}),e.jsx(se,{variant:"body2",sx:{flex:1},children:G.label})]}),e.jsx(Ee,{anchorEl:Y,open:!!Y,onClose:()=>W(null),PaperProps:{sx:{minWidth:140}},children:Pe.map(c=>e.jsxs(ce,{onClick:()=>U(c.value),selected:R===c.value,children:[e.jsx(ye,{sx:{minWidth:36},children:e.jsx(be,{sx:{fontSize:"1.125rem",color:c.color==="#ffffff"?d.palette.divider:c.color}})}),e.jsx(xe,{children:c.label})]},c.value||"p4"))})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(Je,{sx:{fontSize:"1.125rem",color:"text.secondary",flexShrink:0}}),e.jsx(h,{component:"button",onClick:c=>q(c.currentTarget),sx:{flex:1,display:"flex",alignItems:"center",gap:.75,py:.75,px:1,border:"1px solid transparent",borderRadius:1,backgroundColor:"transparent",cursor:"pointer",fontSize:"0.875rem",color:"text.primary",fontFamily:"inherit",textAlign:"left",transition:"background-color 0.15s, border-color 0.15s","&:hover":{backgroundColor:x(d.palette.text.primary,.04),borderColor:"divider"}},children:e.jsx(se,{variant:"body2",sx:{flex:1},children:D?tt(D)?"Today":ue(D,"MMM d"):"No date"})}),e.jsx(rt,{anchorEl:B,value:D,onClose:()=>q(null),onChange:c=>{M(c?le(c):null),a(t.id,{dueDate:c?le(c):void 0,updatedAt:new Date})}})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(Ze,{sx:{fontSize:"1.125rem",color:"text.secondary"}}),e.jsxs(h,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:[X.map(c=>e.jsx(je,{label:c.name,size:"small",onDelete:()=>_(c.id),sx:{fontSize:"0.75rem",height:22,bgcolor:c.color||"default",color:c.color?"white":"inherit"}},c.id)),e.jsx(je,{icon:e.jsx(Ht,{sx:{fontSize:"0.875rem !important"}}),label:"Add",size:"small",variant:"outlined",onClick:c=>g(c.currentTarget),sx:{fontSize:"0.75rem",height:24,cursor:"pointer"}}),e.jsx(Ee,{anchorEl:V,open:!!V,onClose:()=>g(null),PaperProps:{sx:{minWidth:180,maxHeight:280}},children:I.length===0?e.jsx(ce,{disabled:!0,children:e.jsx(xe,{children:o.length===0?"No tags yet":"All tags added"})}):I.map(c=>e.jsxs(ce,{onClick:()=>H(c.id),children:[e.jsx(ye,{sx:{minWidth:32},children:e.jsx(h,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:c.color||d.palette.divider}})}),e.jsx(xe,{children:c.name})]},c.id))})]})]})]})]})]})})};export{Ut as I,sr as T,ir as a,lr as b,Me as c};
