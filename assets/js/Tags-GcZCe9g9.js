var xe=Object.defineProperty,ue=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var q=(r,i,n)=>i in r?xe(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n,$=(r,i)=>{for(var n in i||(i={}))ge.call(i,n)&&q(r,n,i[n]);if(Q)for(var n of Q(i))he.call(i,n)&&q(r,n,i[n]);return r},R=(r,i)=>ue(r,pe(i));var C=(r,i,n)=>new Promise((D,S)=>{var e=c=>{try{b(n.next(c))}catch(h){S(h)}},m=c=>{try{b(n.throw(c))}catch(h){S(h)}},b=c=>c.done?D(c.value):Promise.resolve(c.value).then(e,m);b((n=n.apply(r,i)).next())});import{V as te,r as l,A as t,H as g,T as x,ar as fe,a7 as Te,h as j,bl as ae,br as be,bs as ke,W as ye,bt as Ce,aC as je,am as Se,bu as ve,bb as we,bo as De,bj as ze}from"./vendor-CbdQs_1R.js";import{u as Ie,c as Me,d as Ae}from"./index-B5I4Nid2.js";import{s as Le,t as P,c as Ee,i as We,a as X,u as Y,d as Fe}from"./tasksService-GERJMSHX.js";import{c as Z,I as Ne,T as Be,a as Oe,b as $e}from"./TaskDetailModal-C0D5rEOJ.js";import"./utils-BuwBnmRf.js";const Re=({tags:r,selectedTags:i,onTagSelect:n,onTagCreate:D,onTagDelete:S})=>{const e=te(),[m,b]=l.useState(""),[c,h]=l.useState(null),k=l.useMemo(()=>r.map(s=>s.trim()).filter(s=>s.length>0),[r]),I=s=>{b(s.target.value),c&&h(null)},y=()=>{const s=m.trim();if(!s){h("Tag name cannot be empty");return}if(k.some(T=>T.toLowerCase()===s.toLowerCase())){h("Tag already exists");return}D(s),b(""),h(null)},z=s=>{s.key==="Enter"&&(s.preventDefault(),y())},M=s=>{n(s)},A=(s,f)=>{s.stopPropagation(),S(f)};return t.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[t.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx(x,{variant:"subtitle2",sx:{textTransform:"uppercase",letterSpacing:.6,fontSize:"0.75rem",color:"text.secondary"},children:"Tags"}),t.jsxs(x,{variant:"caption",sx:{color:"text.disabled",fontSize:"0.7rem"},children:[k.length," total"]})]}),t.jsxs(g,{sx:{display:"flex",gap:1},children:[t.jsx(fe,{size:"small",fullWidth:!0,variant:"outlined",placeholder:"Create new tag",value:m,onChange:I,onKeyDown:z,inputProps:{"data-testid":"tag-input"},error:!!c,helperText:c||" "}),t.jsx(Te,{"aria-label":"Add tag",onClick:y,sx:{alignSelf:"flex-start",mt:.25,borderRadius:1,border:`1px solid ${j(e.palette.divider,.7)}`,backgroundColor:j(e.palette.primary.main,.04),"&:hover":{backgroundColor:j(e.palette.primary.main,.1)}},children:t.jsx(ae,{fontSize:"small"})})]}),t.jsxs(g,{sx:{display:"flex",flexWrap:"wrap",gap:.75,mt:.5},children:[k.map(s=>{const f=i.includes(s);return t.jsx(g,{"data-testid":`tag-${s}`,className:f?"selected":void 0,sx:{display:"inline-flex"},children:t.jsx(be,{label:s,size:"small",onClick:()=>M(s),onDelete:T=>A(T,s),deleteIcon:t.jsx(ke,{"data-testid":"delete-tag",sx:{fontSize:"1rem"}}),sx:{fontSize:"0.8125rem",borderRadius:"999px",border:`1px solid ${f?e.palette.primary.main:j(e.palette.divider,.8)}`,backgroundColor:f?j(e.palette.primary.main,.12):j(e.palette.action.hover,.2),color:f?e.palette.primary.main:e.palette.text.secondary,"& .MuiChip-label":{px:1.5},"& .MuiChip-deleteIcon":{color:j(e.palette.text.secondary,.7),"&:hover":{color:e.palette.error.main}},cursor:"pointer"}})},s)}),k.length===0&&t.jsx(x,{variant:"body2",sx:{color:"text.secondary",fontSize:"0.8125rem"},children:"No tags yet. Create your first tag above."})]}),c&&t.jsx(x,{variant:"caption",color:"error",sx:{mt:-1,fontSize:"0.75rem"},children:c})]})};function ee(r){return r.trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}const Ke=()=>{const r=te(),i=ye(),{tagSlug:n}=Ce(),S=je(r.breakpoints.down("sm"))?56:64,{user:e}=Ie(),{tags:m,loading:b,tagsError:c,addTag:h,deleteTag:k}=Me(),{openModal:I,closeModal:y,isOpen:z}=Ae(),[M,A]=l.useState([]),[s,f]=l.useState(null),[T,L]=l.useState([]),[_,E]=l.useState(!1),[W,F]=l.useState(!1),[H,N]=l.useState(null),[se,U]=l.useState(null),ne=l.useMemo(()=>m.map(a=>a.name),[m]),u=l.useMemo(()=>{var a;return n&&(a=m.find(o=>ee(o.name)===n))!=null?a:null},[n,m]),v=!!n;Se.useEffect(()=>{if(!v||!(e!=null&&e.id)){L([]),E(!1);return}E(!0);const a=Le(e.id,{completionStatus:"all",sortBy:"creationDate",sortOrder:"desc"},o=>{const d=o.tasks.map(p=>X(p));L(d),E(!1)});return()=>a()},[v,e==null?void 0:e.id]);const B=l.useMemo(()=>u?T.filter(a=>{var o;return(o=a.tags)==null?void 0:o.includes(u.id)}):[],[T,u]),oe=l.useCallback(a=>{i(`/tags/${ee(a)}`)},[i]),ie=l.useCallback(a=>C(void 0,null,function*(){const o=a.trim();if(!o||(f(null),m.some(w=>w.name.toLowerCase()===o.toLowerCase())))return;const p=Z[m.length%Z.length];try{yield h({name:o,color:p})}catch(w){f("Failed to create tag. Check that you are signed in and have permission.")}}),[m,h]),le=l.useCallback(a=>C(void 0,null,function*(){const o=m.find(d=>d.name===a);if(o)try{yield k(o.id),A(d=>d.filter(p=>p!==a))}catch(d){f("Failed to delete tag.")}}),[m,k]),G=l.useCallback(a=>C(void 0,null,function*(){var V;if(!(e!=null&&e.id)||!u)return;const o=[...(V=a.tags)!=null?V:[],u.id].filter((O,ce,me)=>me.indexOf(O)===ce),d=P(R($({},a),{tags:o,userId:e.id,completed:!1,order:T.length})),p=yield Ee(e.id,d);We(e.id);const w=ve.now(),de=R($({id:p},d),{createdAt:w,updatedAt:w});L(O=>[X(de),...O]),U(p),setTimeout(()=>U(null),600),F(!1),y()}),[e==null?void 0:e.id,u,T.length,y]),J=l.useCallback(a=>C(void 0,null,function*(){if(!(e!=null&&e.id))return;const o=T.find(p=>p.id===a);if(!o)return;const d=P({completed:!o.completed});yield Y(a,d,e.id)}),[e==null?void 0:e.id,T]),re=l.useCallback(a=>C(void 0,null,function*(){e!=null&&e.id&&(yield Fe(a,e.id))}),[e==null?void 0:e.id]),K=l.useCallback((a,o)=>C(void 0,null,function*(){if(!(e!=null&&e.id))return;const d=P(o);yield Y(a,d,e.id)}),[e==null?void 0:e.id]);return v&&!u?t.jsxs(g,{sx:{p:3},children:[t.jsx(x,{color:"text.secondary",children:"Tag not found."}),t.jsx(x,{component:"button",onClick:()=>i("/tags"),sx:{textDecoration:"underline",cursor:"pointer",mt:1},children:"Back to Tags"})]}):t.jsx(g,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"flex-start",width:"100%",pl:0,ml:-1,mt:-.5},children:t.jsx(we,{maxWidth:"md",disableGutters:!0,sx:{width:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start"},children:t.jsxs(g,{sx:{width:"100%",maxWidth:r.breakpoints.values.sm},children:[t.jsx(g,{sx:{position:"sticky",top:S,zIndex:10,backgroundColor:"background.default",borderBottom:1,borderColor:"divider",pb:2,mb:3},children:v&&u?t.jsxs(t.Fragment,{children:[t.jsx(x,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8125rem",mb:.25},children:"Filters & Labels /"}),t.jsx(x,{component:"h1",variant:"h6",sx:{fontWeight:700,fontSize:"1.5rem",lineHeight:1.3},children:u.name}),!W&&t.jsxs(g,{component:"button",onClick:()=>F(!0),sx:{display:"inline-flex",alignItems:"center",gap:.5,mt:1,p:0,border:"none",background:"none",cursor:"pointer",color:"primary.main",fontSize:"0.875rem","&:hover":{textDecoration:"underline"}},children:[t.jsx(ae,{sx:{fontSize:"1.125rem"}}),"Add task"]})]}):t.jsxs(t.Fragment,{children:[t.jsx(x,{component:"h1",variant:"h6",sx:{fontWeight:700,mb:.5,fontSize:"1.5rem",lineHeight:1.3},children:"Tags"}),t.jsx(x,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem"},children:"Create and manage tags to organize your tasks."})]})}),v&&u?t.jsxs(t.Fragment,{children:[W&&t.jsx(g,{sx:{mb:2},children:t.jsx(Ne,{onSubmit:G,onCancel:()=>F(!1),defaultTagIds:[u.id]})}),!W&&B.length===0&&!_&&t.jsxs(g,{sx:{textAlign:"center",py:6,px:2},children:[t.jsx(De,{sx:{fontSize:64,color:"text.disabled",mb:2}}),t.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:1},children:"Try adding this label to some tasks…"}),t.jsxs(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Click the + to add a task and it'll automatically get the ",u.name," label!"]})]}),B.length>0&&B.map(a=>{const o=a.id===se,d=t.jsx(Be,{task:a,onToggleComplete:()=>J(a.id),onDelete:()=>re(a.id),onEdit:p=>{N(p),I()},onUpdate:K},a.id);return o?t.jsx(ze.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},children:d},a.id):d}),H?t.jsx(Oe,{open:z,onClose:()=>{y(),N(null)},task:H,onUpdate:K,onToggleComplete:J}):t.jsx($e,{open:z,onClose:()=>{y(),N(null)},onSubmit:G,initialTask:null,loading:_,defaultTagIds:[u.id]})]}):t.jsxs(t.Fragment,{children:[t.jsx(Re,{tags:ne,selectedTags:M,onTagSelect:oe,onTagCreate:ie,onTagDelete:le}),b&&t.jsx(x,{sx:{mt:2},color:"text.secondary",variant:"body2",children:"Loading tags…"}),(c||s)&&t.jsx(x,{sx:{mt:2},color:"error",variant:"body2",children:s!=null?s:c})]})]})})})};export{Ke as default};
