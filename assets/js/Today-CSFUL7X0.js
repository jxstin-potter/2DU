var ge=Object.defineProperty,ye=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var ie=(p,t,s)=>t in p?ge(p,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[t]=s,re=(p,t)=>{for(var s in t||(t={}))je.call(t,s)&&ie(p,s,t[s]);if(ne)for(var s of ne(t))ke.call(t,s)&&ie(p,s,t[s]);return p},le=(p,t)=>ye(p,be(t));var F=(p,t,s)=>new Promise((y,S)=>{var a=x=>{try{I(s.next(x))}catch(h){S(h)}},W=x=>{try{I(s.throw(x))}catch(h){S(h)}},I=x=>x.done?y(x.value):Promise.resolve(x.value).then(a,W);I((s=s.apply(p,t)).next())});import{r as n,j as e,ag as $}from"./vendor-BwNiVhmj.js";import{u as he,a2 as Te,B as i,T as C,k as Ce,p as Z,au as ee,av as te,aw as oe,ax as de,ay as Se,ar as ce,S as we,d as ve,az as De}from"./mui-z4ihkPrE.js";import{c as Ee,d as xe,u as ze,l as Ie}from"./index-ChBqKc9D.js";import{s as Me,t as se,u as me,d as Be,c as Oe,a as Fe}from"./tasksService-DHXsAsTk.js";import{T as ae,I as ue,a as We,b as Re}from"./TaskDetailModal-CKBa4nUZ.js";import{T as pe}from"./TodayAddTaskButton-1Lxusnso.js";import{B as L,z as Ue,d as Pe}from"./utils-DwmbZkdi.js";const He=({tasks:p,justAddedTaskId:t=null,onTaskAction:s,onCreateTask:y,defaultCategoryId:S})=>{const a=he(),{categories:W}=Ee(),x=Te(a.breakpoints.down("sm"))?56:64,{closeModal:h}=xe(),[V,f]=n.useState(!0),[b,R]=n.useState(!1),[_,N]=n.useState(!0),[Y,w]=n.useState(!1),[k,U]=n.useState(()=>L(new Date)),[M,B]=n.useState(null);n.useEffect(()=>{const o=()=>{const T=new Date,E=new Date(T);E.setHours(24,0,0,0);const X=E.getTime()-T.getTime();return window.setTimeout(()=>{U(L(new Date)),m.current=o()},X)},m={current:o()},u=()=>{if(document.visibilityState==="visible"){const T=L(new Date);U(E=>E.getTime()===T.getTime()?E:T)}};return document.addEventListener("visibilitychange",u),()=>{clearTimeout(m.current),document.removeEventListener("visibilitychange",u)}},[]);const v=n.useCallback(o=>F(void 0,null,function*(){y&&(yield y(o),w(!1),h())}),[y,h]),G=n.useCallback(()=>{w(!1),h()},[h]),{overdueTasks:A,todayTasks:Q,todayIncomplete:O,todayCompleted:P,taskCount:H,tasksForSummary:D}=n.useMemo(()=>{const o=[],m=[];let u=0;p.forEach(c=>{if(!c.dueDate)return;const z=L(new Date(c.dueDate));Ue(z,k)?(o.push(c),c.completed||u++):z.getTime()===k.getTime()&&(m.push(c),c.completed||u++)});const T=o.filter(c=>!c.completed);T.sort((c,z)=>!c.dueDate||!z.dueDate?0:new Date(c.dueDate).getTime()-new Date(z.dueDate).getTime()),m.sort((c,z)=>c.completed!==z.completed?c.completed?1:-1:new Date(c.createdAt).getTime()-new Date(z.createdAt).getTime());const E=m.filter(c=>!c.completed),X=m.filter(c=>c.completed&&L(new Date(c.updatedAt)).getTime()===k.getTime()),fe=[...T,...E,...X];return{overdueTasks:T,todayTasks:m,todayIncomplete:E,todayCompleted:X,taskCount:u,tasksForSummary:fe}},[p,k]),q=Pe(k,"MMM d 'Today' - EEEE"),K={low:"#4caf50",medium:"#ff9800",high:"#f44336"},l=o=>{const m=W.find(u=>u.id===o.categoryId);return m!=null&&m.color?m.color:o.priority&&K[o.priority]?K[o.priority]:a.palette.error.main},r=9,d=D.slice(0,r),j=Math.max(0,D.length-r),g=!!M,J=g?"today-summary-more-popover":void 0;return e.jsxs(i,{sx:{width:"100%"},children:[e.jsxs(i,{sx:{position:"sticky",top:x,zIndex:10,backgroundColor:"background.default",borderBottom:1,borderColor:"divider",pb:2,mb:4},children:[e.jsx(C,{component:"h1",variant:"h6",sx:{fontWeight:700,mb:.5,fontSize:"1.5rem",lineHeight:1.3},children:"Today"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5,mb:D.length>0?1:1.5},children:[e.jsx(Ce,{sx:{fontSize:"0.75rem",color:"text.secondary"}}),e.jsxs(C,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:[H," ",H===1?"task":"tasks"]}),D.length>0&&e.jsx(Z,{size:"small",onClick:()=>N(o=>!o),"aria-label":_?"Hide task list":"Show task list",sx:{p:.25,minWidth:0,color:"text.disabled","&:hover":{color:"text.secondary",backgroundColor:"transparent"}},children:_?e.jsx(ee,{sx:{fontSize:"1rem"}}):e.jsx(te,{sx:{fontSize:"1rem"}})})]}),D.length>0&&e.jsx(oe,{in:_,children:e.jsxs(i,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:.5,fontSize:"0.8125rem",color:"text.secondary",maxHeight:48,overflow:"hidden",mb:1},children:[d.map(o=>e.jsxs(i,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:.75,mr:1.25,flexShrink:0},children:[e.jsx(i,{component:"span",sx:{width:3,height:10,borderRadius:.5,flexShrink:0,backgroundColor:l(o)}}),e.jsxs(C,{component:"span",variant:"body2",sx:{fontSize:"0.8125rem",color:"text.secondary",textDecoration:o.completed?"line-through":"none"},children:[o.completed?"✓ ":"",o.title]})]},o.id)),j>0&&e.jsx(de,{onClick:o=>B(o.currentTarget),"aria-describedby":J,sx:{borderRadius:.75,px:.75,py:.25,lineHeight:1.2,color:"text.disabled","&:hover":{color:"text.secondary",backgroundColor:"action.hover"}},children:e.jsxs(C,{component:"span",variant:"body2",sx:{fontSize:"0.8125rem",color:"inherit"},children:[j," more"]})})]})})]}),e.jsx(Se,{id:J,open:g,anchorEl:M,onClose:()=>B(null),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{mt:.5,borderRadius:2,minWidth:280,maxWidth:420,boxShadow:a.shadows[6]}},children:e.jsx(i,{sx:{py:.5,maxHeight:360,overflowY:"auto"},children:D.map(o=>e.jsxs(de,{onClick:()=>{B(null),s.edit(o)},sx:{width:"100%",textAlign:"left",px:1.5,py:.75,display:"flex",alignItems:"center",gap:1,"&:hover":{backgroundColor:"action.hover"}},children:[e.jsx(i,{sx:{width:3,height:14,borderRadius:.75,flexShrink:0,backgroundColor:l(o)}}),e.jsxs(C,{variant:"body2",sx:{fontSize:"0.875rem",color:"text.primary",textDecoration:o.completed?"line-through":"none"},children:[o.completed?"✓ ":"",o.title]})]},o.id))})}),A.length>0&&e.jsxs(i,{sx:{mb:a.spacing(3)},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:a.spacing(1)},children:[e.jsx(Z,{size:"small",onClick:()=>f(!V),sx:{p:a.spacing(.5)},children:V?e.jsx(ee,{fontSize:"small"}):e.jsx(te,{fontSize:"small"})}),e.jsx(C,{variant:"h6",sx:{fontWeight:a.typography.fontWeightBold,fontSize:a.typography.body1.fontSize},children:"Overdue"})]}),e.jsx(oe,{in:V,children:e.jsx(i,{children:A.map(o=>{const m=o.id===t,u=e.jsx(ae,{task:o,onToggleComplete:s.toggle,onDelete:s.delete,onEdit:s.edit,onUpdate:s.update},o.id);return m?e.jsx($.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},children:u},o.id):u})})})]}),e.jsxs(i,{children:[e.jsx(C,{variant:"h6",sx:{fontWeight:a.typography.fontWeightBold,fontSize:a.typography.body1.fontSize,mb:a.spacing(2)},children:q}),Q.length>0?e.jsxs(e.Fragment,{children:[O.map(o=>{const m=o.id===t,u=e.jsx(ae,{task:o,onToggleComplete:s.toggle,onDelete:s.delete,onEdit:s.edit,onUpdate:s.update},o.id);return m?e.jsx($.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},children:u},o.id):u}),Y&&y?e.jsx(i,{sx:{mt:a.spacing(2),mb:a.spacing(1)},children:e.jsx(ue,{onSubmit:v,onCancel:G,defaultCategoryId:S})}):e.jsx(i,{sx:{mt:a.spacing(.5),width:"100%"},children:e.jsx(pe,{onClick:()=>w(!0)})}),P.length>0&&e.jsxs(i,{sx:{mt:a.spacing(2),mb:a.spacing(1)},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:a.spacing(1)},children:[e.jsx(Z,{size:"small",onClick:()=>R(!b),sx:{p:a.spacing(.5)},children:b?e.jsx(ee,{fontSize:"small"}):e.jsx(te,{fontSize:"small"})}),e.jsxs(C,{variant:"h6",sx:{fontWeight:a.typography.fontWeightBold,fontSize:a.typography.body1.fontSize},children:["Completed (",P.length,")"]})]}),e.jsx(oe,{in:b,children:e.jsx(i,{children:P.map(o=>{const m=o.id===t,u=e.jsx(ae,{task:o,onToggleComplete:s.toggle,onDelete:s.delete,onEdit:s.edit,onUpdate:s.update},o.id);return m?e.jsx($.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},children:u},o.id):u})})})]})]}):e.jsx(i,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:a.spacing(1.5)},children:Y&&y?e.jsx(ue,{onSubmit:v,onCancel:G,defaultCategoryId:S}):e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"body2",color:"text.secondary",sx:{fontSize:a.typography.body2.fontSize,mb:1},children:"No tasks for today"}),e.jsx(i,{sx:{width:"100%"},children:e.jsx(pe,{onClick:()=>w(!0)})})]})})]})]})},Qe=()=>{const p=he(),{user:t,loading:s}=ze(),{isOpen:y,openModal:S,closeModal:a}=xe(),[W,I]=n.useState([]),[x,h]=n.useState(!0),[V,f]=n.useState(null),[b,R]=n.useState(null),[_,N]=n.useState(null),[Y,w]=n.useState(!1),[k,U]=n.useState(null),M=n.useRef(0),B=n.useRef([]);B.current=W,n.useEffect(()=>{if(!(t!=null&&t.id)){I([]),h(!1),M.current=0;return}h(!0),f(null),M.current=0;const l=Me(t.id,{completionStatus:"all",sortBy:"creationDate",sortOrder:"desc"},r=>{try{const d=r.tasks.length;if(d===0&&M.current>0)return;M.current=d;const j=r.tasks.map(g=>{var J;try{return Fe(g)}catch(o){return{id:g.id||"",title:g.title||"Untitled Task",completed:(J=g.completed)!=null?J:!1,userId:g.userId||"",createdAt:new Date,updatedAt:new Date}}});I(j),h(!1),f(null)}catch(d){f("Failed to process tasks"),h(!1)}});return()=>{l()}},[t==null?void 0:t.id]);const v=n.useCallback(l=>F(void 0,null,function*(){if(!(t!=null&&t.id)){f("Please log in to toggle tasks");return}try{const r=B.current.find(g=>g.id===l);if(!r)return;const d=!r.completed,j=se({completed:d});yield me(l,j,t.id),d&&(U(l),w(!0))}catch(r){f(r instanceof Error?r.message:"Failed to toggle task status")}}),[t==null?void 0:t.id]),G=n.useCallback(()=>{k&&(v(k),w(!1),U(null))},[k,v]),A=n.useCallback((l,r)=>{r!=="clickaway"&&(w(!1),U(null))},[]),Q=n.useCallback(l=>F(void 0,null,function*(){if(!(t!=null&&t.id)){f("Please log in to delete tasks");return}try{yield Be(l,t.id)}catch(r){f(r instanceof Error?r.message:"Failed to delete task")}}),[t==null?void 0:t.id]),O=n.useCallback((l,r)=>F(void 0,null,function*(){if(!(t!=null&&t.id)){f("Please log in to update tasks");return}try{const d=se(r);yield me(l,d,t.id)}catch(d){f(d instanceof Error?d.message:"Failed to update task")}}),[t==null?void 0:t.id]),P=n.useCallback(l=>{R(l),S()},[S]),H=n.useCallback(l=>F(void 0,null,function*(){var r;try{if(s)throw new Error("Please wait for authentication to complete");if(!(t!=null&&t.id))throw new Error("Please log in to create tasks");const d=(r=l.dueDate)!=null?r:L(new Date),j=se(le(re({},l),{dueDate:d,userId:t.id,completed:!1,order:B.current.length})),g=yield Oe(t.id,j);N(g),setTimeout(()=>N(null),600),R(null),a()}catch(d){const j=d instanceof Error?d.message:"Failed to create task";throw f(j),Ie.error("Failed to create task",{action:"createTask"},d),d}}),[s,t==null?void 0:t.id,a]),D=n.useMemo(()=>({toggle:v,delete:Q,update:O,edit:P}),[v,Q,O,P]),q=n.useCallback(()=>{a(),R(null)},[a]),K=n.useMemo(()=>b?l=>F(void 0,null,function*(){b.id&&(yield O(b.id,l),a(),R(null))}):H,[b,O,a,H]);return x?e.jsx(ce,{maxWidth:"lg",children:e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"})}):e.jsx(i,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"flex-start",width:"100%",pl:0,ml:-1,mt:-.5},children:e.jsxs(ce,{maxWidth:"md",disableGutters:!0,sx:{width:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx(i,{sx:{width:"100%",maxWidth:p.breakpoints.values.sm},children:e.jsx(He,{tasks:W,justAddedTaskId:_,onTaskAction:D,onCreateTask:H})}),b?e.jsx(We,{open:y,onClose:q,task:b,onUpdate:O,onToggleComplete:v}):e.jsx(Re,{open:y,onClose:q,onSubmit:K,initialTask:null,loading:x}),e.jsx(we,{open:Y,anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:15e3,onClose:A,message:"1 task completed",action:e.jsxs(e.Fragment,{children:[e.jsx(ve,{color:"inherit",size:"small",onClick:G,children:"Undo"}),e.jsx(Z,{size:"small","aria-label":"Close",color:"inherit",onClick:()=>A(),children:e.jsx(De,{fontSize:"small"})})]}),sx:{left:16,bottom:16}})]})})};export{Qe as default};
