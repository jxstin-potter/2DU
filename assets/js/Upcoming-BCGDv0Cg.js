var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var Y=(t,e,o)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,R=(t,e)=>{for(var o in e||(e={}))se.call(e,o)&&Y(t,o,e[o]);if(W)for(var o of W(e))oe.call(e,o)&&Y(t,o,e[o]);return t},H=(t,e)=>te(t,ae(e));var S=(t,e,o)=>new Promise((g,h)=>{var p=m=>{try{i(o.next(m))}catch(r){h(r)}},u=m=>{try{i(o.throw(m))}catch(r){h(r)}},i=m=>m.done?g(m.value):Promise.resolve(m.value).then(p,u);i((o=o.apply(t,e)).next())});import{V as q,A as s,H as I,T as D,K as G,bl as ne,bm as K,bn as re,bo as ce,bp as ie,bq as le,r as l,bb as de,a8 as ue,S as me,a7 as pe,bk as he}from"./vendor-CbdQs_1R.js";import{u as fe,d as ge,l as ke}from"./index-B5I4Nid2.js";import{T as xe,a as ye,b as Te}from"./TaskDetailModal-C0D5rEOJ.js";import{D as $,H as be,B as _e,b as Ce,e as N,w as we}from"./utils-BuwBnmRf.js";import{s as De,t as F,u as L,d as je,c as Se,a as Ie}from"./tasksService-GERJMSHX.js";const ve="_container_148xm_1",Ee="_iconToday_148xm_57 _iconContainer_148xm_27",Me="_iconUpcoming_148xm_67 _iconContainer_148xm_27",Ne="_iconCompleted_148xm_77 _iconContainer_148xm_27",Ae="_iconTags_148xm_87 _iconContainer_148xm_27",Ue="_iconCalendar_148xm_97 _iconContainer_148xm_27",Fe="_title_148xm_107",$e="_description_148xm_121",x={container:ve,iconToday:Ee,iconUpcoming:Me,iconCompleted:Ne,iconTags:Ae,iconCalendar:Ue,title:Fe,description:$e},Oe=({type:t,onCreateTask:e})=>{const o=q(),g=()=>{switch(t){case"today":return x.iconToday;case"upcoming":return x.iconUpcoming;case"completed":return x.iconCompleted;case"tags":return x.iconTags;case"calendar":return x.iconCalendar;default:return x.iconToday}},h=()=>{const i={fontSize:60,color:t==="completed"?o.palette.success.main:o.palette.primary.main};switch(t){case"today":return s.jsx(K,{sx:i});case"upcoming":return s.jsx(le,{sx:i});case"completed":return s.jsx(ie,{sx:i});case"tags":return s.jsx(ce,{sx:i});case"calendar":return s.jsx(re,{sx:i});default:return s.jsx(K,{sx:i})}},p=()=>{switch(t){case"today":return"No tasks for today";case"upcoming":return"No upcoming tasks";case"completed":return"No completed tasks";case"tags":return"No tagged tasks";case"calendar":return"No tasks scheduled";default:return"No tasks"}},u=()=>{switch(t){case"today":return"You have no tasks scheduled for today. Add a new task to get started.";case"upcoming":return"You have no upcoming tasks. Plan ahead by adding tasks with future due dates.";case"completed":return"You haven't completed any tasks yet. Complete tasks to see them here.";case"tags":return"You haven't tagged any tasks yet. Add tags to your tasks to organize them.";case"calendar":return"You have no tasks scheduled. Add tasks with due dates to see them in your calendar.";default:return"You have no tasks. Add a new task to get started."}};return s.jsxs(I,{className:x.container,sx:{borderColor:o.palette.divider,backgroundColor:o.palette.mode==="dark"?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)"},children:[s.jsx("div",{className:g(),children:h()}),s.jsx(D,{variant:"h5",className:x.title,sx:{color:o.palette.text.primary,mb:.5},children:p()}),s.jsx(D,{variant:"body2",className:x.description,sx:{color:o.palette.text.secondary,mb:3,maxWidth:"400px"},children:u()}),e&&s.jsx(G,{variant:"contained",color:"primary",startIcon:s.jsx(ne,{}),onClick:e,sx:{borderRadius:"6px","&:hover":{transform:"translateY(-2px)",boxShadow:o.shadows[4]}},children:"Add New Task"})]})};function V(t){return N(t,"yyyy-MM-dd")}function Pe(t,e){const o=N(t,"MMM d");return we(t,e)?`${o} ‧ Today ‧ ${N(t,"EEEE")}`:`${o} ‧ ${N(t,"EEEE")}`}function w(t){return $(new Date(t))}function ze(t){return t.completed!==!0&&t.dueDate!=null}function Be(t,e){var m;const o=$(new Date),g=w(e.startDate),h=t.filter(ze);let p=w(be(e.focusedMonth));for(const r of h){const f=w(r.dueDate);f.getTime()>p.getTime()&&(p=f)}const u=new Map;for(const r of h){const f=w(r.dueDate);if(_e(f,g))continue;const c=V(f),k=u.get(c);k?k.push(r):u.set(c,[r])}const i=[];for(let r=g;r.getTime()<=p.getTime();r=Ce(r,1)){const f=V(r),c=(m=u.get(f))!=null?m:[];c.length!==0&&(c.sort((k,y)=>{var _,C;const A=w(k.dueDate).getTime(),j=w(y.dueDate).getTime();if(A!==j)return A-j;const v=(_=k.order)!=null?_:Number.POSITIVE_INFINITY,b=(C=y.order)!=null?C:Number.POSITIVE_INFINITY;return v!==b?v-b:k.title.localeCompare(y.title)}),i.push({key:f,kind:"day",title:Pe(r,o),date:r,anchorId:`selection-${f}`,tasks:c}))}return i}const qe=()=>{const t=q(),{user:e,loading:o}=fe(),{isOpen:g,openModal:h,closeModal:p}=ge(),[u,i]=l.useState([]),[m,r]=l.useState(!0),[f,c]=l.useState(null),[k,y]=l.useState(null),[A,j]=l.useState(null),[v,b]=l.useState(!1),[_,C]=l.useState(null),E=l.useRef(0);l.useEffect(()=>{if(!(e!=null&&e.id)){i([]),r(!1),E.current=0;return}r(!0),c(null),E.current=0;const n=De(e.id,{completionStatus:"all",sortBy:"creationDate",sortOrder:"desc"},a=>{try{const d=a.tasks.length;if(d===0&&E.current>0)return;E.current=d;const U=a.tasks.map(T=>{var B;try{return Ie(T)}catch(We){return{id:T.id||"",title:T.title||"Untitled Task",completed:(B=T.completed)!=null?B:!1,userId:T.userId||"",createdAt:new Date,updatedAt:new Date}}});i(U),a.fromServer!==!1&&r(!1),c(null)}catch(d){c("Failed to process tasks"),r(!1)}});return()=>n()},[e==null?void 0:e.id]);const M=l.useCallback(n=>S(void 0,null,function*(){if(!(e!=null&&e.id)){c("Please log in to toggle tasks");return}try{const a=u.find(T=>T.id===n);if(!a)return;const d=!a.completed,U=F({completed:d});yield L(n,U,e.id),d&&(C(n),b(!0))}catch(a){c(a instanceof Error?a.message:"Failed to toggle task status")}}),[u,e==null?void 0:e.id]),J=l.useCallback(()=>{_&&(M(_),b(!1),C(null))},[_,M]),O=l.useCallback((n,a)=>{a!=="clickaway"&&(b(!1),C(null))},[]),Q=l.useCallback(n=>S(void 0,null,function*(){if(!(e!=null&&e.id)){c("Please log in to delete tasks");return}try{yield je(n,e.id)}catch(a){c(a instanceof Error?a.message:"Failed to delete task")}}),[e==null?void 0:e.id]),P=l.useCallback((n,a)=>S(void 0,null,function*(){if(!(e!=null&&e.id)){c("Please log in to update tasks");return}try{const d=F(a);yield L(n,d,e.id)}catch(d){c(d instanceof Error?d.message:"Failed to update task")}}),[e==null?void 0:e.id]),X=l.useCallback(n=>S(void 0,null,function*(){try{if(o)throw new Error("Please wait for authentication to complete");if(!(e!=null&&e.id))throw new Error("Please log in to create tasks");const a=F(H(R({},n),{userId:e.id,completed:!1,order:u.length})),d=yield Se(e.id,a);j(d),setTimeout(()=>j(null),600),y(null),p()}catch(a){const d=a instanceof Error?a.message:"Failed to create task";throw c(d),ke.error("Failed to create task",{action:"createTask"},a),a}}),[o,p,u.length,e==null?void 0:e.id]),z=l.useMemo(()=>{const n=u.filter(a=>!a.completed&&a.dueDate!=null);return Be(n,{focusedMonth:new Date,startDate:$(new Date)})},[u]),Z=z.some(n=>n.tasks.length>0);return s.jsx(I,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"flex-start",width:"100%",pl:0,ml:-1,mt:-.5},children:s.jsxs(de,{maxWidth:"md",disableGutters:!0,sx:{width:"100%",maxWidth:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[s.jsxs(I,{sx:{width:"100%",maxWidth:t.breakpoints.values.sm},children:[s.jsxs(I,{sx:{mb:2},children:[s.jsx(D,{variant:"h5",component:"h1",sx:{fontWeight:t.typography.fontWeightBold,mb:.5},children:"Upcoming"}),s.jsx(D,{variant:"body2",color:"text.secondary",children:"Tasks with due dates, grouped by day."})]}),!m&&!Z?s.jsx(Oe,{type:"upcoming",onCreateTask:()=>h()}):z.map(n=>s.jsxs(I,{id:n.anchorId,sx:{mb:3},children:[s.jsx(D,{variant:"h6",sx:{fontWeight:t.typography.fontWeightBold,fontSize:t.typography.body1.fontSize,mb:1.5,color:"text.secondary"},children:n.title}),n.tasks.length===0?s.jsx(D,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"No tasks"}):s.jsx(ue,{sx:{py:0},children:n.tasks.map(a=>s.jsx(xe,{task:a,onToggleComplete:()=>M(a.id),onDelete:()=>Q(a.id),onEdit:()=>{y(a),h()},onUpdate:P,isActionInProgress:!1},a.id))})]},n.key))]}),k?s.jsx(ye,{open:g,onClose:()=>{p(),y(null)},task:k,onUpdate:P,onToggleComplete:M}):s.jsx(Te,{open:g,onClose:()=>{p(),y(null)},onSubmit:X,initialTask:null,loading:m}),s.jsx(me,{open:v,anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:15e3,onClose:O,message:"1 task completed",action:s.jsxs(s.Fragment,{children:[s.jsx(G,{color:"inherit",size:"small",onClick:J,children:"Undo"}),s.jsx(pe,{size:"small","aria-label":"Close",color:"inherit",onClick:()=>O(),children:s.jsx(he,{fontSize:"small"})})]}),sx:{left:16,bottom:16}})]})})};export{qe as default};
